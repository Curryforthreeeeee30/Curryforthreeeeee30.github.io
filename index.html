<!DOCTYPE html>
<html lang="zh-CN">
<head>

  

  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="m5NcKgUu0g" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wyqian.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":320,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Do not talk, show me your code!">
<meta property="og:type" content="website">
<meta property="og:title" content="SC&amp;KD&#39;s Blog">
<meta property="og:url" content="http://wyqian.top/index.html">
<meta property="og:site_name" content="SC&amp;KD&#39;s Blog">
<meta property="og:description" content="Do not talk, show me your code!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="精进的coder">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://wyqian.top/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>SC&KD's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SC&KD's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">小Q写字的地方</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-allergies fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-battery-full fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Curryforthreeeeee30" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/06/06/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%94%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/06/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%94%EF%BC%89/" class="post-title-link" itemprop="url">单体电商项目架构，开发与上线（五）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-06 20:26:43" itemprop="dateCreated datePublished" datetime="2021-06-06T20:26:43+08:00">2021-06-06</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/06/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%94%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/06/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%94%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/06/02/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/02/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/" class="post-title-link" itemprop="url">单体电商项目项目，开发与上线（四）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-02 20:00:36" itemprop="dateCreated datePublished" datetime="2021-06-02T20:00:36+08:00">2021-06-02</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/02/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/02/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="本章概述"><a href="#本章概述" class="headerlink" title="本章概述"></a>本章概述</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_100305.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_100406.png" alt></p>
<p>这里的个人中心和门户网站的前端是分开来部署的，将foodie-center文件夹放到tomcat的webapps里面：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_100912.png" alt></p>
<h3 id="用户中心-查询用户信息"><a href="#用户中心-查询用户信息" class="headerlink" title="用户中心-查询用户信息"></a>用户中心-查询用户信息</h3><p>这里和在门户网站的套路是一样的。</p>
<p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_104721.png" alt></p>
<p>2、写ServiceImpl实现类：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_104801.png" alt></p>
<p>3、写controller</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_104837.png" alt></p>
<p>前端：</p>
<p>先将app.js里面的后端服务地址修改掉：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_104926.png" alt></p>
<p>然后重启项目，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_105028.png" alt></p>
<p>可以看到，用户信息并没有渲染出来。这时候F12打开控制台调试，可以看到下面的信息：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_105124.png" alt></p>
<p>前端报了405错误，打开黄框框中的地址：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_105224.png" alt></p>
<p>可以看到，后端的确返回了正确的用户信息。那么后端没有问题，就是前端的问题，前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_105334.png" alt></p>
<p>仔细观察这段代码，axios请求方式为post，而后端为get请求方式，所以这里可以修改前端为get请求方式，当然也可以改后端为post请求方式。</p>
<p>修改完之后，重新刷新页面，测试通过！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_105529.png" alt></p>
<h3 id="用户中心-修改用户信息"><a href="#用户中心-修改用户信息" class="headerlink" title="用户中心-修改用户信息"></a>用户中心-修改用户信息</h3><p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_114705.png" alt></p>
<p>2、写ServiceImpl实现类，这里和之前一样使用了SpringBoot自带的BeanUtils工具类<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_114733.png" alt></p>
<p>3、写controller</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_114854.png" alt></p>
<p>4、测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_115013.png" alt></p>
<p>查看数据库：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_115031.png" alt></p>
<h3 id="用户中心-使用Hibernate验证用户信息"><a href="#用户中心-使用Hibernate验证用户信息" class="headerlink" title="用户中心-使用Hibernate验证用户信息"></a>用户中心-使用Hibernate验证用户信息</h3><p>前端对用户信息租了验证，后端也要做！</p>
<p>我们可以按照之前的方式，将centerUserBO里面的属性取出来，一一做验证，但是这样的方式代码量太大，而且有一些都是重复性的代码。</p>
<p>这里我们使用Hibernate 进行验证。</p>
<p>我们可以打开External Libraries看一下：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_120431.png" alt></p>
<p>我们并没有专门的导入依赖，为什么就已经有Hibernate 了呢？</p>
<p>我们打开顶级工程的pom.xml文件，右键，show dependencies，可以看到，当我们导入了spring-boot-starter-web的依赖之后，就自动导入了Hibernate 的依赖。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_120310.png" alt></p>
<p>这里直接在entity的属性上使用注解即可：</p>
<p><img src="/2021/06/02/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89%5C2021-06-03_140650.png" alt></p>
<p><img src="/2021/06/02/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E5%9B%9B%EF%BC%89%5C2021-06-03_140656.png" alt></p>
<p>然后在controller里面加上以下代码：<br>1、在BO的参数处加上@Valid注解：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_140827.png" alt></p>
<p>2、加上参数，BindingResult参数可以返回错误信息</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_140858.png" alt></p>
<p>3、加上判断：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_140943.png" alt></p>
<p>4、getErrors()方法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_141020.png" alt></p>
<p>5、在postman里测试：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_140553.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_141310.png" alt></p>
<h3 id="上传头像-定义文件保存位置"><a href="#上传头像-定义文件保存位置" class="headerlink" title="上传头像-定义文件保存位置"></a>上传头像-定义文件保存位置</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_144247.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_144312.png" alt></p>
<p>这里的File.separator是根据不同操作系统设计的，源码如下：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_144412.png" alt></p>
<h3 id="上传头像-上传到指定目录"><a href="#上传头像-上传到指定目录" class="headerlink" title="上传头像-上传到指定目录"></a>上传头像-上传到指定目录</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(value = <span class="string">"用户头像修改"</span>, notes = <span class="string">"用户头像修改"</span>, httpMethod = <span class="string">"POST"</span>)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"uploadFace"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> IMOOCJSONResult <span class="title">uploadFace</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @ApiParam(name = <span class="string">"userId"</span>, value = <span class="string">"用户id"</span>, required = <span class="keyword">true</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam String userId,</span></span><br><span class="line"><span class="function">    @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"file"</span>, value = <span class="string">"用户头像"</span>, required = <span class="keyword">true</span>)</span></span></span><br><span class="line"><span class="function">    MultipartFile file,</span></span><br><span class="line"><span class="function">    HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义头像保存的地址</span></span><br><span class="line">    String fileSpace = IMAGE_USER_FACE_LOCATION;</span><br><span class="line">    <span class="comment">//在路径上为每一个用户增加一个userid，用于区分不同用户上传</span></span><br><span class="line">    String uploadPathPrefix = File.separator + userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始文件上传</span></span><br><span class="line">    <span class="keyword">if</span>(file != <span class="keyword">null</span>)&#123;</span><br><span class="line">        FileOutputStream fileOutputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//获得文件上传的文件名称</span></span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotBlank(fileName)) &#123;</span><br><span class="line">                <span class="comment">// 文件重命名 imooc-face.png -&gt;   ["imooc-face", "png"]</span></span><br><span class="line">                String fileNameArr[] = fileName.split(<span class="string">"\\."</span>);</span><br><span class="line">                <span class="comment">//获得文件的后缀名</span></span><br><span class="line">                String suffix = fileNameArr[fileNameArr.length - <span class="number">1</span>];</span><br><span class="line">                <span class="comment">//face-&#123;userid&#125;.png</span></span><br><span class="line">                <span class="comment">// 文件名称重组  覆盖式上传，增量式：需要额外拼接当前时间</span></span><br><span class="line">                String newFileName = <span class="string">"face-"</span> + userId + <span class="string">"."</span> + suffix;</span><br><span class="line">                <span class="comment">//上传的头像最终保存的位置</span></span><br><span class="line">                String finalFacePath = fileSpace + uploadPathPrefix + File.separator + newFileName;</span><br><span class="line"></span><br><span class="line">                File outFile = <span class="keyword">new</span> File(finalFacePath);</span><br><span class="line">                <span class="keyword">if</span> (outFile.getParentFile() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//创建文件夹</span></span><br><span class="line">                    outFile.getParentFile().mkdirs();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//文件输出保存到目录</span></span><br><span class="line">                fileOutputStream = <span class="keyword">new</span> FileOutputStream(outFile);</span><br><span class="line">                InputStream inputStream = file.getInputStream();</span><br><span class="line">                IOUtils.copy(inputStream, fileOutputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(fileOutputStream != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    fileOutputStream.flush();</span><br><span class="line">                    fileOutputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="string">"文件不能为空!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> IMOOCJSONResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p>在前端点击用户头像，上传之后，可以看到faces文件夹下多了一个以用户id命名的子文件夹，并且该子文件夹下多了张图片。<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_152054.png" alt></p>
<h3 id="上传头像-属性资源文件与类映射"><a href="#上传头像-属性资源文件与类映射" class="headerlink" title="上传头像-属性资源文件与类映射"></a>上传头像-属性资源文件与类映射</h3><p>我们的项目一般会有好几个运行环境，包括：开发环境、测试环境、生产环境等等。</p>
<p>那么我们如果将文件路径写在BaseController中的话，那么我们就要写多份代码，在每一个环境中将其他环境中的代码注释掉，这样的写法不是太好。</p>
<p>我们将他们卸载资源文件中，在不同的环境中使用不同的资源文件中即可。</p>
<p>这里，我们建了两个文件：</p>
<p>file-upload-dev.properties和file-upload-prod.properties</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_154406.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_154416.png" alt></p>
<p>要想使用这些资源文件，我们使用注解：<strong><em>@PropertySource</em></strong></p>
<p>要使用资源文件里面的属性，我们还要使用<strong><em>@ConfigurationProperties</em></strong>注解配置前缀。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_154623.png" alt></p>
<p>然后，在CenterUserController里面注入刚刚的类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_154646.png" alt></p>
<p>将之前的写法（继承BaseController）换成新的写法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_154814.png" alt></p>
<h3 id="上传头像-为静态资源提供网络映射服务"><a href="#上传头像-为静态资源提供网络映射服务" class="headerlink" title="上传头像-为静态资源提供网络映射服务"></a>上传头像-为静态资源提供网络映射服务</h3><p>我们想实现，将图片在浏览器中打开，这样的话，我们需要为本地的图片提供一种网络资源映射：</p>
<p>实现WebMvcConfigurer接口，重写addResourceHandlers方法。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_161847.png" alt></p>
<p>这里由于重写了本地文件映射之后，我们的swagger无法正常打开了，所以这里也影射了一下Swagger2</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_161610.png" alt></p>
<p>测试，已经能通过tomcat访问了</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_162004.png" alt></p>
<h3 id="上传头像-更新用户头像到数据库"><a href="#上传头像-更新用户头像到数据库" class="headerlink" title="上传头像-更新用户头像到数据库"></a>上传头像-更新用户头像到数据库</h3><p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_165630.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_165652.png" alt></p>
<p>3、写Controller:</p>
<p>这里主要是图片地址的更新，我们将图片地址分成两部分：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_165748.png" alt></p>
<p>url的第一部分：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_165940.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_170001.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_170034.png" alt></p>
<p>url的第二部分：拼接</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_170108.png" alt></p>
<p>由于浏览器可能存在缓存的情况，所以在这里，我们需要加上时间戳来保证更新后的图片可以及时在前端刷新</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_170202.png" alt></p>
<p>最后，和之前登录的时候一样，将userResult的一些属性设置为空，再传递到前端cookie。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_170302.png" alt></p>
<p>最后，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_170653.png" alt></p>
<h3 id="上传头像-图片格式限制以防后门"><a href="#上传头像-图片格式限制以防后门" class="headerlink" title="上传头像-图片格式限制以防后门"></a>上传头像-图片格式限制以防后门</h3><p>这里后端一定要做的一件事（不管前端做没做，因为黑客可能绕过前端，直接对后端服务器进行攻击）：对图片格式做限制，防止黑客对服务器进行攻击。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_171835.png" alt></p>
<p>测试：</p>
<p>前端源码是允许gif格式的文件上传的，但是后端是不允许的，这样的话，会报图片格式不正确：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_172022.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_172417.png" alt></p>
<h3 id="上传头像-大小限制，以及自定义捕获异常"><a href="#上传头像-大小限制，以及自定义捕获异常" class="headerlink" title="上传头像-大小限制，以及自定义捕获异常"></a>上传头像-大小限制，以及自定义捕获异常</h3><p>我们需要对用户上传头像的图片大小做限制。</p>
<p>在application.yml文件中，可以定义文件上传大小以及请求大小限制：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_192830.png" alt></p>
<p>在做了上述限制之后，用户如果上传了超过500k的图片，那么控制台会报错：<br>MaxUploadSizeExceededException，我们需要捕获这个异常：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_192745.png" alt></p>
<p>这里对@RestControllerAdvice做一个说明：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-03_193203.png" alt></p>
<h3 id="订单管理-查询我的订单SQL"><a href="#订单管理-查询我的订单SQL" class="headerlink" title="订单管理-查询我的订单SQL"></a>订单管理-查询我的订单SQL</h3><p>SQL测试语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	od.id <span class="keyword">as</span> orderId,</span><br><span class="line">	od.created_time <span class="keyword">as</span> createdTime,</span><br><span class="line">	od.pay_method <span class="keyword">as</span> payMethod,</span><br><span class="line">	od.real_pay_amount <span class="keyword">as</span> realPayAmount,</span><br><span class="line">	od.post_amount <span class="keyword">as</span> postAmount,</span><br><span class="line">	os.order_status <span class="keyword">as</span> orderStatus,</span><br><span class="line">	oi.item_id <span class="keyword">as</span> itemId,</span><br><span class="line">	oi.item_name <span class="keyword">as</span> itemName,</span><br><span class="line">	oi.item_img <span class="keyword">as</span> itemImg,</span><br><span class="line">	oi.item_spec_id <span class="keyword">as</span> itemSpecId,</span><br><span class="line">	oi.item_spec_name <span class="keyword">as</span> itemSpecName,</span><br><span class="line">	oi.buy_counts <span class="keyword">as</span> buyCounts,</span><br><span class="line">	oi.price <span class="keyword">as</span> price</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	orders od</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	order_status os</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	od.id = os.order_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	order_items oi</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	od.id = oi.order_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	od.user_id = <span class="string">"1908017YR51G1XWH"</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">	od.is_delete = <span class="number">0</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">	od.updated_time <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>

<h3 id="订单管理-编写查询Mapper与Service"><a href="#订单管理-编写查询Mapper与Service" class="headerlink" title="订单管理-编写查询Mapper与Service"></a>订单管理-编写查询Mapper与Service</h3><p>1、写Mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_155034.png" alt></p>
<p>2、写Mapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.wyqian.mapper.OrdersMapperCustom"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myOrdersVO"</span> <span class="attr">type</span>=<span class="string">"com.wyqian.pojo.vo.CategoryVO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"orderId"</span> <span class="attr">property</span>=<span class="string">"orderId"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createdTime"</span> <span class="attr">property</span>=<span class="string">"createdTime"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"payMethod"</span> <span class="attr">property</span>=<span class="string">"payMethod"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"realPayAmount"</span> <span class="attr">property</span>=<span class="string">"realPayAmount"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"postAmount"</span> <span class="attr">property</span>=<span class="string">"postAmount"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"orderStatus"</span> <span class="attr">property</span>=<span class="string">"orderStatus"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"subOrderItemList"</span> <span class="attr">ofType</span>=<span class="string">"com.wyqian.pojo.vo.MySubOrderItemVO"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemId"</span> <span class="attr">property</span>=<span class="string">"itemId"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemName"</span> <span class="attr">property</span>=<span class="string">"itemName"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemImg"</span> <span class="attr">property</span>=<span class="string">"itemImg"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemSpecId"</span> <span class="attr">property</span>=<span class="string">"itemSpecId"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemSpecName"</span> <span class="attr">property</span>=<span class="string">"itemSpecName"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"buyCounts"</span> <span class="attr">property</span>=<span class="string">"buyCounts"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"price"</span> <span class="attr">property</span>=<span class="string">"price"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryMyOrders"</span> <span class="attr">resultMap</span>=<span class="string">"myOrdersVO"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            od.id as orderId,</span><br><span class="line">            od.created_time as createdTime,</span><br><span class="line">            od.pay_method as payMethod,</span><br><span class="line">            od.real_pay_amount as realPayAmount,</span><br><span class="line">            od.post_amount as postAmount,</span><br><span class="line">            os.order_status as orderStatus,</span><br><span class="line">            oi.item_id as itemId,</span><br><span class="line">            oi.item_name as itemName,</span><br><span class="line">            oi.item_img as itemImg,</span><br><span class="line">            oi.item_spec_id as itemSpecId,</span><br><span class="line">            oi.item_spec_name as itemSpecName,</span><br><span class="line">            oi.buy_counts as buyCounts,</span><br><span class="line">            oi.price as price</span><br><span class="line">        FROM</span><br><span class="line">            orders od</span><br><span class="line">        LEFT JOIN</span><br><span class="line">            order_status os</span><br><span class="line">        ON</span><br><span class="line">            od.id = os.order_id</span><br><span class="line">        LEFT JOIN</span><br><span class="line">            order_items oi</span><br><span class="line">        ON</span><br><span class="line">            od.id = oi.order_id</span><br><span class="line">        WHERE</span><br><span class="line">            od.user_id = #&#123;paramsMap.userId&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"paramsMap.orderStatus != null"</span>&gt;</span></span><br><span class="line">                and os.order_status = #&#123;paramsMap.orderStatus&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        AND</span><br><span class="line">            od.is_delete = 0</span><br><span class="line">        ORDER BY</span><br><span class="line">            od.updated_time ASC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_155145.png" alt></p>
<p>4、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_155215.png" alt></p>
<h3 id="订单管理-查询订单controller与前端联调"><a href="#订单管理-查询订单controller与前端联调" class="headerlink" title="订单管理-查询订单controller与前端联调"></a>订单管理-查询订单controller与前端联调</h3><p>相关前端源码为：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_161316.png" alt></p>
<p>controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyqian.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wyqian.service.center.MyOrdersService;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.utils.IMOOCJSONResult;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.utils.PagedGridResult;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span>(value = <span class="string">"用户中心我的订单"</span>, tags = &#123;<span class="string">"用户中心我的订单的相关接口"</span>&#125;)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"myorders"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyOrdersController</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyOrdersService myOrdersService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"查询订单列表"</span>, notes = <span class="string">"查询订单列表"</span>, httpMethod = <span class="string">"POST"</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/query"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMOOCJSONResult <span class="title">query</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @ApiParam(name = <span class="string">"userId"</span>, value = <span class="string">"用户id"</span>, required = <span class="keyword">true</span>)</span></span></span><br><span class="line"><span class="function">            @RequestParam String userId,</span></span><br><span class="line"><span class="function">            @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"orderStatus"</span>, value = <span class="string">"订单状态"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">            @RequestParam Integer orderStatus,</span></span><br><span class="line"><span class="function">            @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"page"</span>, value = <span class="string">"查询下一页的第几页"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">            @RequestParam Integer page,</span></span><br><span class="line"><span class="function">            @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"pageSize"</span>, value = <span class="string">"分页的每一页显示的条数"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">            @RequestParam Integer pageSize)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(userId))&#123;</span><br><span class="line">            <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(page == <span class="keyword">null</span>)&#123;</span><br><span class="line">            page = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(pageSize == <span class="keyword">null</span>)&#123;</span><br><span class="line">            pageSize = COMMON_PAGE_SIZE;</span><br><span class="line">        &#125;</span><br><span class="line">        PagedGridResult grid = myOrdersService.queryMyOrders(userId,</span><br><span class="line">                                                            orderStatus,</span><br><span class="line">                                                            page,</span><br><span class="line">                                                            pageSize);</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.ok(grid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_161149.png" alt></p>
<h3 id="订单管理-嵌套查询分页bug解决方案"><a href="#订单管理-嵌套查询分页bug解决方案" class="headerlink" title="订单管理-嵌套查询分页bug解决方案"></a>订单管理-嵌套查询分页bug解决方案</h3><p>但是会发现有一个小问题，在我们的代码中，设置的是每一页展示10条数据。但是测试的时候发现有的页面却是8条。</p>
<p>查询mybatis-pagehelper的github官网：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_162726.png" alt></p>
<p>解决：修改XML文件的sql语句，先查询出来orderId，再根据orderId查询出来独影的itemId即可解决：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myOrdersVO"</span> <span class="attr">type</span>=<span class="string">"com.wyqian.pojo.vo.MyOrdersVO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"orderId"</span> <span class="attr">property</span>=<span class="string">"orderId"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createdTime"</span> <span class="attr">property</span>=<span class="string">"createdTime"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"payMethod"</span> <span class="attr">property</span>=<span class="string">"payMethod"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"realPayAmount"</span> <span class="attr">property</span>=<span class="string">"realPayAmount"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"postAmount"</span> <span class="attr">property</span>=<span class="string">"postAmount"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"orderStatus"</span> <span class="attr">property</span>=<span class="string">"orderStatus"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"subOrderItemList"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">"getSubItems"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">"orderId"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ofType</span>=<span class="string">"com.wyqian.pojo.vo.MySubOrderItemVO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemId"</span> <span class="attr">property</span>=<span class="string">"itemId"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemName"</span> <span class="attr">property</span>=<span class="string">"itemName"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemImg"</span> <span class="attr">property</span>=<span class="string">"itemImg"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemSpecName"</span> <span class="attr">property</span>=<span class="string">"itemSpecName"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"buyCounts"</span> <span class="attr">property</span>=<span class="string">"buyCounts"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"price"</span> <span class="attr">property</span>=<span class="string">"price"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryMyOrders"</span> <span class="attr">resultMap</span>=<span class="string">"myOrdersVO"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        od.id as orderId,</span><br><span class="line">        od.created_time as createdTime,</span><br><span class="line">        od.pay_method as payMethod,</span><br><span class="line">        od.real_pay_amount as realPayAmount,</span><br><span class="line">        od.post_amount as postAmount,</span><br><span class="line">        os.order_status as orderStatus</span><br><span class="line">    FROM</span><br><span class="line">    	orders od</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	order_status os</span><br><span class="line">    ON</span><br><span class="line">    	od.id = os.order_id</span><br><span class="line">    WHERE</span><br><span class="line">        od.user_id = #&#123;paramsMap.userId&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"paramsMap.orderStatus != null"</span>&gt;</span></span><br><span class="line">            and os.order_status = #&#123;paramsMap.orderStatus&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    AND</span><br><span class="line">   		od.is_delete = 0</span><br><span class="line">    ORDER BY</span><br><span class="line">    	od.updated_time ASC</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getSubItems"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"com.wyqian.pojo.vo.MySubOrderItemVO"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        oi.item_id as itemId,</span><br><span class="line">        oi.item_name as itemName,</span><br><span class="line">        oi.item_img as itemImg,</span><br><span class="line">        oi.item_spec_name as itemSpecName,</span><br><span class="line">        oi.buy_counts as buyCounts,</span><br><span class="line">        oi.price as price</span><br><span class="line">    FROM</span><br><span class="line">    	order_items oi</span><br><span class="line">    WHERE</span><br><span class="line">    	oi.order_id = #&#123;orderId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="订单管理-商家发货"><a href="#订单管理-商家发货" class="headerlink" title="订单管理-商家发货"></a>订单管理-商家发货</h3><p>根据不同的订单状态，会有不同的交易操作。</p>
<p>那么这里由于没有商家后台系统，所以写一个接口去模拟商家发货。</p>
<p>1、写Service接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_175624.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_175655.png" alt></p>
<p>3、写Controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_175723.png" alt></p>
<p>4、测试</p>
<p>直接再浏览器url栏中访问后端接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_175526.png" alt></p>
<p>再回到我的订单页面—&gt;待收货页面就多了一条数据：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-04_175517.png" alt></p>
<h3 id="订单管理-操作订单前的验证"><a href="#订单管理-操作订单前的验证" class="headerlink" title="订单管理-操作订单前的验证"></a>订单管理-操作订单前的验证</h3><p>用户可以进行确认收货和删除订单操作。</p>
<p>相关前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_102428.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_102933.png" alt></p>
<p>后端源码，查询订单id和用户id是否匹配：<br>1、Service接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_130455.png" alt></p>
<p>2、ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_130527.png" alt></p>
<p>3、controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_130620.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_130651.png" alt></p>
<h3 id="订单管理-确认收货与删除订单"><a href="#订单管理-确认收货与删除订单" class="headerlink" title="订单管理-确认收货与删除订单"></a>订单管理-确认收货与删除订单</h3><p>1、写Service接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_214058.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_214124.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_214130.png" alt></p>
<p>3、写controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_214212.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_214221.png" alt></p>
<p>4、测试：</p>
<p>对确认收货的测试：</p>
<p>针对这条订单，点击确认收货：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_214318.png" alt></p>
<p>查看已完成一栏：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_215311.png" alt></p>
<p>对删除订单的测试：</p>
<p>对订单id为“210529B6WX2TDCDP”的订单进行删除：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_215401.png" alt></p>
<p>删除之后，查看数据库，is_delete字段已经变成了1</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-05_215450.png" alt></p>
<h3 id="评价管理-评价需求分析"><a href="#评价管理-评价需求分析" class="headerlink" title="评价管理-评价需求分析"></a>评价管理-评价需求分析</h3><p>先来看一下生产环境中的商品评价部分：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_094953.png" alt></p>
<p>在已完成订单栏，有一个评价商品，点击可以对商品发表评论：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095050.png" alt></p>
<p>然后再来看一下我们自己的评价部分：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095136.png" alt></p>
<p>看一下前端源码：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095228.png" alt></p>
<p>orderStatus一定是40的，那问题应该出在isComment上。我们来看一下前端渲染订单数据的时候，数据到底是什么样子的。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095358.png" alt></p>
<p>可以看到，前端控制台打印出来的数据，isComment为空！<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095536.png" alt></p>
<p>那么去查看后端代码，VO里面有isComment字段，那应该是没有查询出来：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095757.png" alt></p>
<p>所以，加上两行代码：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_095854.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_100749.png" alt></p>
<p>重启项目，去前端页面查看，评价商品的div块已经成功显示！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_100936.png" alt></p>
<h3 id="评价管理-查询待评价商品列表"><a href="#评价管理-查询待评价商品列表" class="headerlink" title="评价管理-查询待评价商品列表"></a>评价管理-查询待评价商品列表</h3><p>评价页面的跳转逻辑，跳转到doComment.html页面：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_101206.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_101239.png" alt></p>
<p>在后端：</p>
<p>1、写Service接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104219.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104242.png" alt></p>
<p>3、写controller:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104309.png" alt></p>
<p>这里使用到了checkUserOrder的方法，为了避免代码重复，我们将这个方法的代码放进BaseController中，并且记得private要改成public。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104420.png" alt></p>
<p>重启项目，测试：</p>
<p>报了空指针异常：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104514.png" alt></p>
<p>在获取了order下一行代码处的地方打断点，重启项目运行，发现checkResult的status为200，但是data为null!</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104639.png" alt></p>
<p>查看checkUserOrder()方法的代码，发现并没有将查询出来的order作为数据传递出去。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104821.png" alt></p>
<p>于是，将上述代码稍加修改一下：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_105013.png" alt></p>
<p>重启项目，运行，订单显示成功！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_104953.png" alt></p>
<h3 id="评价管理-评价商品-1"><a href="#评价管理-评价商品-1" class="headerlink" title="评价管理-评价商品-1"></a>评价管理-评价商品-1</h3><p>保存评论的前端相关代码：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_111301.png" alt></p>
<p>后端代码：</p>
<p>新建一个OrderItemsCommentBO类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_112343.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_112208.png" alt></p>
<p>重启项目，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_112149.png" alt></p>
<h3 id="评价管理-评价商品-2"><a href="#评价管理-评价商品-2" class="headerlink" title="评价管理-评价商品-2"></a>评价管理-评价商品-2</h3><p>1、写Mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_163155.png" alt></p>
<p>2、写Mapper.xml，这里用到了动态SQL里面的foreach：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"saveComments"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">    insert into</span><br><span class="line">    items_comments</span><br><span class="line">    (</span><br><span class="line">    id,</span><br><span class="line">    user_id,</span><br><span class="line">    item_id,</span><br><span class="line">    item_name,</span><br><span class="line">    item_spec_id,</span><br><span class="line">    spec_name,</span><br><span class="line">    comment_level,</span><br><span class="line">    content,</span><br><span class="line">    created_time,</span><br><span class="line">    updated_time</span><br><span class="line">    )</span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"commentList"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        (</span><br><span class="line">        #&#123;item.commentId&#125;,</span><br><span class="line">        #&#123;userId&#125;,</span><br><span class="line">        #&#123;item.itemId&#125;,</span><br><span class="line">        #&#123;item.itemName&#125;,</span><br><span class="line">        #&#123;item.itemSpecId&#125;,</span><br><span class="line">        #&#123;item.itemSpecName&#125;,</span><br><span class="line">        #&#123;item.commentLevel&#125;,</span><br><span class="line">        #&#123;item.content&#125;,</span><br><span class="line">        now(),</span><br><span class="line">        now()</span><br><span class="line">        )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_163340.png" alt></p>
<p>4、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_163410.png" alt></p>
<p>5、写controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_163438.png" alt></p>
<p>6、测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_163500.png" alt></p>
<h3 id="评价管理-历史评价列表Mapper"><a href="#评价管理-历史评价列表Mapper" class="headerlink" title="评价管理-历史评价列表Mapper"></a>评价管理-历史评价列表Mapper</h3><p>主要涉及到两张表的查询–item_img表和items_comments表</p>
<p>1、mapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myComments"</span> <span class="attr">type</span>=<span class="string">"com.wyqian.pojo.vo.MyCommentVO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"commentId"</span> <span class="attr">property</span>=<span class="string">"commentId"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"content"</span> <span class="attr">property</span>=<span class="string">"content"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createdTime"</span> <span class="attr">property</span>=<span class="string">"createdTime"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemId"</span> <span class="attr">property</span>=<span class="string">"itemId"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemName"</span> <span class="attr">property</span>=<span class="string">"itemName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"specName"</span> <span class="attr">property</span>=<span class="string">"specName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemImg"</span> <span class="attr">property</span>=<span class="string">"itemImg"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryMyComments"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span> <span class="attr">resultMap</span>=<span class="string">"myComments"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        ic.id as commentId,</span><br><span class="line">        ic.content as content,</span><br><span class="line">        ic.created_time as createdTime,</span><br><span class="line">        ic.item_id as itemId,</span><br><span class="line">        ic.item_name as itemName,</span><br><span class="line">        ic.spec_name as specName,</span><br><span class="line">        ii.url as itemImg</span><br><span class="line">    FROM</span><br><span class="line">    	items_comments ic</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items_img ii</span><br><span class="line">    ON</span><br><span class="line">    	ic.item_id = ii.item_id</span><br><span class="line">    WHERE</span><br><span class="line">    	ic.user_id = #&#123;paramsMap.userId&#125;</span><br><span class="line">    AND</span><br><span class="line">    	ii.is_main = 1</span><br><span class="line">    ORDER BY</span><br><span class="line">    	ic.created_time DESC</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、mapper的接口:<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_165518.png" alt></p>
<h3 id="评价管理-完成与实现历史评价列表"><a href="#评价管理-完成与实现历史评价列表" class="headerlink" title="评价管理-完成与实现历史评价列表"></a>评价管理-完成与实现历史评价列表</h3><p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_171441.png" alt></p>
<p>2、写ServiceImpl实现类，这里将setterPagedGrid方法单独提出来了，放在了BaseService类下面，然后当前类继承BaseService类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_171556.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_171630.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_171510.png" alt></p>
<p>3、写controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(value = <span class="string">"查询我的评价"</span>, notes = <span class="string">"查询我的评价"</span>, httpMethod = <span class="string">"POST"</span>)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/query"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> IMOOCJSONResult <span class="title">query</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @ApiParam(name = <span class="string">"userId"</span>, value = <span class="string">"用户id"</span>, required = <span class="keyword">true</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam String userId,</span></span><br><span class="line"><span class="function">    @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"page"</span>, value = <span class="string">"查询下一页的第几页"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam Integer page,</span></span><br><span class="line"><span class="function">    @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"pageSize"</span>, value = <span class="string">"分页的每一页显示的条数"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(userId))&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(page == <span class="keyword">null</span>)&#123;</span><br><span class="line">        page = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pageSize == <span class="keyword">null</span>)&#123;</span><br><span class="line">        pageSize = COMMON_PAGE_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line">    PagedGridResult grid = myCommentsService.queryMyComments(userId,</span><br><span class="line">                                                             page,</span><br><span class="line">                                                             pageSize);</span><br><span class="line">    <span class="keyword">return</span> IMOOCJSONResult.ok(grid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、重启项目，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_171750.png" alt></p>
<h3 id="中心首页-订单状态概览Mapper"><a href="#中心首页-订单状态概览Mapper" class="headerlink" title="中心首页-订单状态概览Mapper"></a>中心首页-订单状态概览Mapper</h3><p>OrderMapperCustom.xml:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_173741.png" alt></p>
<p>OrderMapperCustom接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_173759.png" alt></p>
<h3 id="中心首页-订单状态概览完成接口联调"><a href="#中心首页-订单状态概览完成接口联调" class="headerlink" title="中心首页-订单状态概览完成接口联调"></a>中心首页-订单状态概览完成接口联调</h3><p>1、Service接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_191613.png" alt></p>
<p>2、ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_191646.png" alt></p>
<p>3、controller:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_191717.png" alt></p>
<p>4、重启测试：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_191804.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/%E7%BD%91%E9%A1%B5%E6%8D%95%E8%8E%B7_6-6-2021_191852_localhost.jpg" alt></p>
<p>可以看到，中心首页展示的是6条待收货，但是订单管理的地方则是5条，这是因为有一条订单已经被删除了，orders表里is_delete字段为1。所以修改一下mapper.xml文件，加上：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_192139.png" alt></p>
<p>这样，重启项目之后：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_192230.png" alt></p>
<h3 id="中心首页-订单动向完成接口联调-1"><a href="#中心首页-订单动向完成接口联调-1" class="headerlink" title="中心首页-订单动向完成接口联调-1"></a>中心首页-订单动向完成接口联调-1</h3><p>首先来看一下生产环境中的订单动向：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_192500.png" alt></p>
<p>主要做的是订单状态为20、30、40的订单，也就是付款完进入的订单流程。</p>
<p>这里也是两张表之间的联表查询—-订单表和订单状态表</p>
<p>1、mapper.xml文件</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_194324.png" alt></p>
<p>2、mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_194343.png" alt></p>
<h3 id="中心首页-订单动向完成接口联调-2"><a href="#中心首页-订单动向完成接口联调-2" class="headerlink" title="中心首页-订单动向完成接口联调-2"></a>中心首页-订单动向完成接口联调-2</h3><p>前端的渲染：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_195344.png" alt></p>
<p>前端js：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_195429.png" alt></p>
<p>后端Service接口:<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_201133.png" alt></p>
<p>ServiceImpl实现类：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_201205.png" alt></p>
<p>controller:<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_201223.png" alt></p>
<p>重启项目，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-06_201258.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">单体电商项目架构，开发与上线（三）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 17:23:15" itemprop="dateCreated datePublished" datetime="2021-05-24T17:23:15+08:00">2021-05-24</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="收货地址-需求分析与表设计"><a href="#收货地址-需求分析与表设计" class="headerlink" title="收货地址-需求分析与表设计"></a>收货地址-需求分析与表设计</h3><p>这里主要涉及到的一张表为：用户地址表</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_203111.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_203342.png" alt></p>
<p>这里新增地址，用到的省市区数据可以放在前端js里去维护，也可以放在后端数据库里去维护。</p>
<ul>
<li>放在前端：不用向后端去请求数据了，省去了一些额外的请求。</li>
<li>放在后端：方便维护，但是一般来说，省市区的数据维护频次也不多，所以总体来讲的话放在前端比较好。</li>
</ul>
<p>这里选择的是放在js中：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_203603.png" alt></p>
<p>新建一个与收货地址相关的controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_204231.png" alt></p>
<h3 id="收货地址-查询收货地址列表"><a href="#收货地址-查询收货地址列表" class="headerlink" title="收货地址-查询收货地址列表"></a>收货地址-查询收货地址列表</h3><p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_211002.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_211056.png" alt></p>
<p>3、写controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_211133.png" alt></p>
<p>4、测试-swagger-ui测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_210903.png" alt></p>
<h3 id="收货地址-新增收货地址"><a href="#收货地址-新增收货地址" class="headerlink" title="收货地址-新增收货地址"></a>收货地址-新增收货地址</h3><p>1、写AddressBO：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_214518.png" alt></p>
<p><img src="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89%5C2021-05-26_214532.png" alt></p>
<p>2、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_214611.png" alt></p>
<p>3、写ServiceImpl实现类，注意这里要处理默认地址的设置问题。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_215052.png" alt></p>
<p>4、写Controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_214734.png" alt></p>
<p>5、测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_214755.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_214415.png" alt></p>
<p>由于新增地址之后，会有一个渲染地址信息的回调函数，所以新增地址这一步也证明了我们查询地址代码写的没有问题。</p>
<h3 id="收货地址-修改收货地址"><a href="#收货地址-修改收货地址" class="headerlink" title="收货地址-修改收货地址"></a>收货地址-修改收货地址</h3><p>1、写Service接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_220545.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_220613.png" alt></p>
<p>3、写controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_220645.png" alt></p>
<p>4、测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_220745.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_220419.png" alt></p>
<h3 id="收货地址-删除收货地址"><a href="#收货地址-删除收货地址" class="headerlink" title="收货地址-删除收货地址"></a>收货地址-删除收货地址</h3><p>1、写Service接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_222205.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_222235.png" alt></p>
<p>3、写controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_222257.png" alt></p>
<p>4、测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_222314.png" alt></p>
<p>查看数据库：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_222121.png" alt></p>
<h3 id="收货地址-设置默认收货地址"><a href="#收货地址-设置默认收货地址" class="headerlink" title="收货地址-设置默认收货地址"></a>收货地址-设置默认收货地址</h3><p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223733.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223759.png" alt></p>
<p>3、写Controller:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223818.png" alt></p>
<p>4、测试：</p>
<p>修改前：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223844.png" alt></p>
<p>数据库：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223649.png" alt></p>
<p>修改后：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223935.png" alt></p>
<p>修改后数据库：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-26_223958.png" alt></p>
<h3 id="确认订单-订单流程梳理与订单状态"><a href="#确认订单-订单流程梳理与订单状态" class="headerlink" title="确认订单-订单流程梳理与订单状态"></a>确认订单-订单流程梳理与订单状态</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_171903.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_172104.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_173850.png" alt></p>
<h3 id="确认订单-订单表设计"><a href="#确认订单-订单表设计" class="headerlink" title="确认订单-订单表设计"></a>确认订单-订单表设计</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_185934.png" alt></p>
<p>订单表说明：</p>
<p>1、收货人快照和收货人手机号快照：这里使用的不是外键id，而是用户在下单的时候使用的收货地址和手机号。所以用的是收货人快照和收货人手机号快照。</p>
<p>2、逻辑删除状态：用户在删除订单的时候，在用户界面上已经删除了，但是在公司数据库中不是真正的删除，因为历史订单可以用作别的用处，比如大数据分析。所以使用的是逻辑删除。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_190512.png" alt></p>
<p>订单商品管理表说明：</p>
<p>1、这里使用的也是商品和规格的快照，和订单表一样。成交价格也是使用的快照。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_191307.png" alt></p>
<p>订单状态表说明：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_191524.png" alt></p>
<p>这里的几个订单状态可以做一个枚举类。</p>
<h3 id="确认订单-讲述聚合支付中心，作用是什么"><a href="#确认订单-讲述聚合支付中心，作用是什么" class="headerlink" title="确认订单-讲述聚合支付中心，作用是什么"></a>确认订单-讲述聚合支付中心，作用是什么</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_192017.png" alt></p>
<p>这里的支付中心封装了微信支付和支付宝的接口。如果自己有企业资质，也可以整合一个支付中心，直接对接微信和支付宝。</p>
<h3 id="确认订单-提交并且接收订单信息"><a href="#确认订单-提交并且接收订单信息" class="headerlink" title="确认订单-提交并且接收订单信息"></a>确认订单-提交并且接收订单信息</h3><p>前端点击提交订单，后端接收相应的数据。</p>
<p>相关的前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_195139.png" alt></p>
<p>所以这里先针对前端传过来的参数进行一个BO类包装：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_195330.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_194942.png" alt></p>
<p>启动项目，测试（即点击“提交订单”）：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_194914.png" alt></p>
<h3 id="创建订单-填充新订单数据"><a href="#创建订单-填充新订单数据" class="headerlink" title="创建订单-填充新订单数据"></a>创建订单-填充新订单数据</h3><p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_210125.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrdersMapper ordersMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Sid sid;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressService addressService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">(SubmitOrderBO submitOrderBO)</span> </span>&#123;</span><br><span class="line">        String userId = submitOrderBO.getUserId();</span><br><span class="line">        String addressId = submitOrderBO.getAddressId();</span><br><span class="line">        String itemSpecIds = submitOrderBO.getItemSpecIds();</span><br><span class="line">        Integer payMethod = submitOrderBO.getPayMethod();</span><br><span class="line">        String leftMsg = submitOrderBO.getLeftMsg();</span><br><span class="line">        <span class="comment">//包邮，邮费为0</span></span><br><span class="line">        Integer postAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        String orderId = sid.nextShort();</span><br><span class="line"></span><br><span class="line">        UserAddress address = addressService.queryUerAddress(userId, addressId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、新订单数据保存</span></span><br><span class="line">        Orders newOrder = <span class="keyword">new</span> Orders();</span><br><span class="line">        newOrder.setId(orderId);</span><br><span class="line">        newOrder.setUserId(userId);</span><br><span class="line"></span><br><span class="line">        newOrder.setReceiverMobile(address.getMobile());</span><br><span class="line">        newOrder.setReceiverName(address.getReceiver());</span><br><span class="line">        newOrder.setReceiverAddress(address.getProvince() + <span class="string">" "</span></span><br><span class="line">                                    + address.getCity() + <span class="string">" "</span></span><br><span class="line">                                    + address.getDistrict() + <span class="string">" "</span></span><br><span class="line">                                    + address.getDetail());</span><br><span class="line">        <span class="comment">//newOrder.setTotalAmount();</span></span><br><span class="line">        <span class="comment">//newOrder.setRealPayAmount();</span></span><br><span class="line">        newOrder.setPostAmount(postAmount);</span><br><span class="line">        newOrder.setPayMethod(payMethod);</span><br><span class="line">        newOrder.setLeftMsg(leftMsg);</span><br><span class="line">        newOrder.setIsComment(YesOrNo.NO.type);</span><br><span class="line">        newOrder.setIsDelete(YesOrNo.YES.type);</span><br><span class="line">        newOrder.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">        newOrder.setUpdatedTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、循环根据itemSpecIds保存订单商品信息表</span></span><br><span class="line">        <span class="comment">//3、保存订单状态表</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、这里由于需要根据userId和地址id查询具体的地址对象信息，所以在第二步之前需要先写一个方法查询一下：</p>
<p>Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_210420.png" alt></p>
<p>ServiceImpl实现：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_210505.png" alt></p>
<h3 id="创建订单-保存订单与子订单数据"><a href="#创建订单-保存订单与子订单数据" class="headerlink" title="创建订单-保存订单与子订单数据"></a>创建订单-保存订单与子订单数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">(SubmitOrderBO submitOrderBO)</span> </span>&#123;</span><br><span class="line">    String userId = submitOrderBO.getUserId();</span><br><span class="line">    String addressId = submitOrderBO.getAddressId();</span><br><span class="line">    String itemSpecIds = submitOrderBO.getItemSpecIds();</span><br><span class="line">    Integer payMethod = submitOrderBO.getPayMethod();</span><br><span class="line">    String leftMsg = submitOrderBO.getLeftMsg();</span><br><span class="line">    <span class="comment">//包邮，邮费为0</span></span><br><span class="line">    Integer postAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    String orderId = sid.nextShort();</span><br><span class="line"></span><br><span class="line">    UserAddress address = addressService.queryUerAddress(userId, addressId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、新订单数据保存</span></span><br><span class="line">    Orders newOrder = <span class="keyword">new</span> Orders();</span><br><span class="line">    newOrder.setId(orderId);</span><br><span class="line">    newOrder.setUserId(userId);</span><br><span class="line"></span><br><span class="line">    newOrder.setReceiverMobile(address.getMobile());</span><br><span class="line">    newOrder.setReceiverName(address.getReceiver());</span><br><span class="line">    newOrder.setReceiverAddress(address.getProvince() + <span class="string">" "</span></span><br><span class="line">                                + address.getCity() + <span class="string">" "</span></span><br><span class="line">                                + address.getDistrict() + <span class="string">" "</span></span><br><span class="line">                                + address.getDetail());</span><br><span class="line"></span><br><span class="line">    newOrder.setPostAmount(postAmount);</span><br><span class="line">    newOrder.setPayMethod(payMethod);</span><br><span class="line">    newOrder.setLeftMsg(leftMsg);</span><br><span class="line">    newOrder.setIsComment(YesOrNo.NO.type);</span><br><span class="line">    newOrder.setIsDelete(YesOrNo.YES.type);</span><br><span class="line">    newOrder.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    newOrder.setUpdatedTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、循环根据itemSpecIds保存订单商品信息表</span></span><br><span class="line">    String[] itemSpecIdArr = itemSpecIds.split(<span class="string">","</span>);</span><br><span class="line">    Integer totalAmount = <span class="number">0</span>;<span class="comment">//商品原价累计</span></span><br><span class="line">    Integer realPayAmount = <span class="number">0</span>;<span class="comment">//优惠后的实际支付价格累计</span></span><br><span class="line">    <span class="keyword">for</span>(String itemSpecId : itemSpecIdArr)&#123;</span><br><span class="line">        <span class="comment">//TODO 整合Redis后，商品购买的数量重新从Redis的购物车中获取</span></span><br><span class="line">        <span class="keyword">int</span> buyCounts  = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//2.1、根据规格id，查询规格的具体信息，主要获取价格</span></span><br><span class="line">        ItemsSpec itemsSpec = itemService.queryItemSpecById(itemSpecId);</span><br><span class="line">        totalAmount += itemsSpec.getPriceNormal() * buyCounts;</span><br><span class="line">        realPayAmount += itemsSpec.getPriceDiscount() * buyCounts;</span><br><span class="line">        <span class="comment">//2.2、根据商品id，获得商品信息以及商品图片</span></span><br><span class="line">        String itemId = itemsSpec.getItemId();</span><br><span class="line">        Items item = itemService.queryItemById(itemId);</span><br><span class="line">        String imgUrl = itemService.queryItemMainImgById(itemId);</span><br><span class="line">        <span class="comment">//2.3、循环保存子订单数据到数据库</span></span><br><span class="line">        String subOrderId = sid.nextShort();</span><br><span class="line">        OrderItems subOrderItem = <span class="keyword">new</span> OrderItems();</span><br><span class="line">        subOrderItem.setId(subOrderId);</span><br><span class="line">        subOrderItem.setOrderId(orderId);</span><br><span class="line">        subOrderItem.setItemId(itemId);</span><br><span class="line">        subOrderItem.setItemImg(imgUrl);</span><br><span class="line">        subOrderItem.setItemName(item.getItemName());</span><br><span class="line">        subOrderItem.setItemSpecId(itemSpecId);</span><br><span class="line">        subOrderItem.setItemSpecName(itemsSpec.getName());</span><br><span class="line">        subOrderItem.setBuyCounts(buyCounts);</span><br><span class="line">        subOrderItem.setPrice(itemsSpec.getPriceDiscount());</span><br><span class="line">        orderItemsMapper.insert(subOrderItem);</span><br><span class="line">    &#125;</span><br><span class="line">    newOrder.setTotalAmount(totalAmount);</span><br><span class="line">    newOrder.setRealPayAmount(realPayAmount);</span><br><span class="line">    ordersMapper.insert(newOrder);</span><br><span class="line">    <span class="comment">//3、保存订单状态表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：上述代码中有两个地方需要注意：</p>
<p>1、根据商品规格id查询商品规格的具体信息需要新写一个方法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_221358.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_221539.png" alt></p>
<p>2、根据商品id获得商品图片主图url需要新写一个方法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_221747.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-28_221828.png" alt></p>
<h3 id="扣除商品库存与订单状态保存"><a href="#扣除商品库存与订单状态保存" class="headerlink" title="扣除商品库存与订单状态保存"></a>扣除商品库存与订单状态保存</h3><p>1、订单状态保存</p>
<p>主要是保存订单id、订单状态、订单创建时间三项</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_094659.png" alt></p>
<p>这里创建了一个订单状态的枚举类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_094752.png" alt></p>
<p>2、扣除库存操作：在提交订单之后我们需要将商品表中的库存相应的扣除。</p>
<p>1、Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_094932.png" alt></p>
<p>2、ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_095511.png" alt></p>
<p>在高并发情况下，为了保证数据的一致性，这里可以考虑如下几种方案：</p>
<p>1、synchronized：不推荐使用，原因有：</p>
<ul>
<li>一个一个的线程去执行，效率低下。</li>
<li>在单体架构的情况下可能是有用的，但是到了集群分布式环境下，有多台服务器，那么服务器之间还是会存在资源共享的问题。</li>
</ul>
<p>2、锁数据库：不推荐，导致数据库性能低下。</p>
<p>3、分布式锁：zookeeper   redis</p>
<p>在这里，我们采用的是乐观锁机制，这里应该算一种广义的乐观锁，线程1拿到数据之后，其他线程也可以访问。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_100117.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_100110.png" alt></p>
<p>在完成上述工作之后，我们在OrderServiceImpl类中调用这个方法就好了：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_100328.png" alt></p>
<h3 id="创建订单-测试订单创建与回滚"><a href="#创建订单-测试订单创建与回滚" class="headerlink" title="创建订单-测试订单创建与回滚"></a>创建订单-测试订单创建与回滚</h3><p>1、首先，需要在controller里调用提交订单的方法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_110827.png" alt></p>
<p>2、 在数据库中，手动修改某一项商品库存为0，比如itemSpecId为cake-1006-spec-1:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_110654.png" alt></p>
<p>3、在前端提交订单，提交的订单中商品除了有：cake-1006-spec-1之外，还有cake-1005-spec-1（库存足够）：报错，库存不足！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_110630.png" alt></p>
<p>4、查看数据库：</p>
<p><img src="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89%5C2021-05-29_110654.png" alt></p>
<p>发现数据并没有被修改，即发生错误时数据库进行了回滚。</p>
<h3 id="创建订单-创建订单后前端的业务处理讲解"><a href="#创建订单-创建订单后前端的业务处理讲解" class="headerlink" title="创建订单-创建订单后前端的业务处理讲解"></a>创建订单-创建订单后前端的业务处理讲解</h3><p>前端：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_123330.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_123607.png" alt></p>
<p>后端：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_123637.png" alt></p>
<p>和前端对应的cookie名：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_123657.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_123831.png" alt></p>
<h3 id="微信支付-支付中心订单设计"><a href="#微信支付-支付中心订单设计" class="headerlink" title="微信支付-支付中心订单设计"></a>微信支付-支付中心订单设计</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_160400.png" alt></p>
<h3 id="微信支付-微信支付时序图"><a href="#微信支付-微信支付时序图" class="headerlink" title="微信支付-微信支付时序图"></a>微信支付-微信支付时序图</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_162559.png" alt></p>
<h3 id="微信支付-构建商户端支付成功的回调接口"><a href="#微信支付-构建商户端支付成功的回调接口" class="headerlink" title="微信支付-构建商户端支付成功的回调接口"></a>微信支付-构建商户端支付成功的回调接口</h3><p>按照上一节讲到的微信支付时序图，第10步，我们需要写一个支付成功后，由支付中心向我们的后台系统发的回调接口。</p>
<p>1、写一个修改订单状态的Service接口：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_165034.png" alt></p>
<p>2、写实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_165125.png" alt></p>
<p>3、写controller</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_165019.png" alt></p>
<p>4、在postman中测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_164750.png" alt></p>
<p>5、可以看到，返回的状态码是200，表明支付成功。查看数据库：order_status确实发生了变化。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-29_164801.png" alt></p>
<h3 id="微信支付-构建商户订单"><a href="#微信支付-构建商户订单" class="headerlink" title="微信支付-构建商户订单"></a>微信支付-构建商户订单</h3><p>1、商户订单信息为（MerchatOrdersVO）：（发送至支付中心的订单数据）</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-30_200712.png" alt></p>
<p>2、在前端还要求后端发送一个orderId,所以后端构建的VO为MerchantOrdersVO+orderId：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-30_201048.png" alt></p>
<p>3、写Service实现（在create()方法中）：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-30_201135.png" alt></p>
<p>4、完善controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-30_201303.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-30_201329.png" alt></p>
<h3 id="微信支付-向支付中心发送商户订单"><a href="#微信支付-向支付中心发送商户订单" class="headerlink" title="微信支付-向支付中心发送商户订单"></a>微信支付-向支付中心发送商户订单</h3><p>这里需要向远程云端的支付中心发起一个请求，使用RestTemplate：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_164021.png" alt></p>
<p>要想使用RestTemplate，还需要配置一下：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_164032.png" alt></p>
<p>然后就可以写controller了：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_164010.png" alt></p>
<p>这里，headers主要是写发起请求的格式、以及其它一些参数。</p>
<p>body里面主要是数据。</p>
<p>重启项目测试：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_163931.png" alt></p>
<h3 id="微信支付-提供支付中心商户订单查询"><a href="#微信支付-提供支付中心商户订单查询" class="headerlink" title="微信支付-提供支付中心商户订单查询"></a>微信支付-提供支付中心商户订单查询</h3><p>由于我们访问不了云端的支付中心数据库，所以支付中心为我们提供了一个可以查看我们的商户订单是否到达了支付中心的方法：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_170416.png" alt></p>
<p>我们可以使用postman进行测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_170151.png" alt></p>
<h3 id="微信支付-生成支付二维码"><a href="#微信支付-生成支付二维码" class="headerlink" title="微信支付-生成支付二维码"></a>微信支付-生成支付二维码</h3><p>也就是时序图中的这部分内容：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_170615.png" alt></p>
<p>生成支付二维码的代码为：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_171245.png" alt></p>
<p>这个方法里需要注意的点有：<br>1、商户订单号：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_171317.png" alt></p>
<p>这里的out_trade_no是和微信支付官方文档中的变量名保持一致的：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_171406.png" alt></p>
<p>2、微信二维码的缓存：<br>微信官方的二维码过期时间为2个小时，所以我们的项目里面设置微信二维码的过期时间要略小于2个小时：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_171803.png" alt></p>
<p>如果缓存里没有二维码数据，那么就需要再次生成：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_172234.png" alt></p>
<p>3、关注一下生成二维码的过程：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_173135.png" alt></p>
<p>​        进入到这个方法中：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_173225.png" alt></p>
<p>4、微信支付平台为天天吃货分配的一个应用ID：        <img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_173517.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_173747.png" alt></p>
<p>​    这个wxpay.properties文件里就是为WXpaySource类属性设置的值：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_173849.png" alt></p>
<p>5、回到placeholder方法中：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_174201.png" alt></p>
<p>这个body可以自己定义：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_174232.png" alt></p>
<p>用户端在支付的时候，可以看到相应的title:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210531184546.png" alt></p>
<p>6、回到placeholder方法中：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_184651.png" alt></p>
<p>商户号：同微信官方文档一致：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_184726.png" alt></p>
<p>在我们的项目里：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_184503.png" alt></p>
<p>7、微信支付通知支付中心的回调地址：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190130.png" alt></p>
<p>在我们的项目里：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190212.png" alt></p>
<p>8、微信支付方式：Native支付</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190436.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190448.png" alt></p>
<p>9、微信支付提交用户端ip地址：127.0.0.1</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190649.png" alt></p>
<p>10、获得签名：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190830.png" alt></p>
<p>密钥：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_190942.png" alt></p>
<p>11、将对象转成xml（类似json）传递：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_191229.png" alt></p>
<p>12、调用微信统一下单地址：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_191307.png" alt></p>
<p>这里的统一下单地址为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_191335.png" alt></p>
<p>统一下单地址来自微信官方文档。</p>
<p>13、返回值为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_191648.png" alt></p>
<p>打开PreOrderResult类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_191717.png" alt></p>
<p>其中，最主要的就是获得code_url。也就是二维码链接。</p>
<h3 id="微信支付-支付中心回调地址"><a href="#微信支付-支付中心回调地址" class="headerlink" title="微信支付-支付中心回调地址"></a>微信支付-支付中心回调地址</h3><p>这一步主要处理的是：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_192359.png" alt></p>
<p>1、返回微信支付的结果，打包成了一个entity：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_193012.png" alt></p>
<p>2、操作商户自己的业务，比如将支付状态修改为已支付。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_193300.png" alt></p>
<p>3、微信支付通知支付中心支付状态。再由支付中心通知商户（天天吃货），这里的回调地址是天天吃货给微信传订单数据的时候一块儿带过去的：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_194242.png" alt></p>
<p>4、支付中心收到消息后，需要通知微信已经收到消息！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_194518.png" alt></p>
<p>如果这一步省略的话，微信会一直访问支付中心接口（10次）。。。所以说一定不能省略。</p>
<h3 id="微信支付-商户回调地址与内网穿透"><a href="#微信支付-商户回调地址与内网穿透" class="headerlink" title="微信支付-商户回调地址与内网穿透"></a>微信支付-商户回调地址与内网穿透</h3><p>我们支付了0.01元，现在我们来访问一下支付中心的订单数据，观察我所支付的订单支付状态是否发生了改变：<br>使用postman测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_200200.png" alt></p>
<p>可以看到支付中心的状态是已经发生了改变的。</p>
<p>去我们自己的数据库中查看一下，状态没有改变。说明是支付中心调用天天吃货出现了问题。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_200327.png" alt></p>
<p>定位问题，出现在回调地址上：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_200523.png" alt></p>
<p>localhost在本机是可以访问的，有人会说能不能把localhost改成自己的内网ip，这是不行的，因为这是你的电脑在其所在局域网的内网ip地址，在外网（公网）依旧是访问不了的。（这里推荐一篇博客搞懂IP地址：<a href="https://www.jianshu.com/p/ad7cd1d5be45）" target="_blank" rel="noopener">https://www.jianshu.com/p/ad7cd1d5be45）</a></p>
<p>因此，我们要做的就是把我们的服务器，也就是本机放到公网上，让我们的支付中心来调用！</p>
<p><strong><em>内网穿透：将自己的电脑发布到互联网，让互联网上的每一台服务器，任何一个第三方系统都能访问到你电脑上的接口。</em></strong></p>
<p>内网穿透工具：NATAPP</p>
<p>官网：<a href="https://natapp.cn/" target="_blank" rel="noopener">https://natapp.cn/</a></p>
<p>一分钟新手教程：<a href="https://natapp.cn/article/natapp_newbie" target="_blank" rel="noopener">https://natapp.cn/article/natapp_newbie</a></p>
<p>通过上述教程：得到了我的本机在外网的访问地址：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_211723.png" alt></p>
<p>测试：</p>
<p>在我们的postman里面：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_212004.png" alt></p>
<p>可以看到返回的状态码是200，查看数据库：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_212230.png" alt></p>
<p>可以看到数据库的状态也变了，测试成功！</p>
<p>但是使用这个工具需要注意的是，如果关机了，下次使用需要重启，相应的穿透后的地址也会改变，那么在项目中也需要改变。</p>
<h3 id="微信支付-轮询支付成功结果"><a href="#微信支付-轮询支付成功结果" class="headerlink" title="微信支付-轮询支付成功结果"></a>微信支付-轮询支付成功结果</h3><p>那么在前面一节的基础上，我们将项目中的回调地址由localhost修改为穿透之后的地址：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_213702.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_213818.png" alt></p>
<p>重启项目，测试：</p>
<p>完成支付后，来到数据库中：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_213958.png" alt></p>
<p>可以看到，相应的订单状态已经发生了改变。</p>
<p>在postman里测试一下该笔订单在支付中心的订单状态：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_214203.png" alt></p>
<p>可以看到的是，状态发生了变化，没有问题。</p>
<p>现在，当用户支付成功之后，页面应当发生相应的跳转，这里我们参考京东的做法，采用js轮询的方式，即每隔几秒钟就调用后端方法，查看用户是否支付成功。</p>
<p>1、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_215711.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_215740.png" alt></p>
<p>3、写controller</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_215802.png" alt></p>
<p>这里的路由和前端保持一致！</p>
<p>4、测试</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_215651.png" alt></p>
<p>相应的前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-31_215840.png" alt></p>
<h3 id="支付宝支付-支付时序图"><a href="#支付宝支付-支付时序图" class="headerlink" title="支付宝支付-支付时序图"></a>支付宝支付-支付时序图</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/1.png" alt></p>
<p>注意这里一定要以异步通知为准，也就是第7步！</p>
<h3 id="支付宝支付-构建支付表单并提交"><a href="#支付宝支付-构建支付表单并提交" class="headerlink" title="支付宝支付-构建支付表单并提交"></a>支付宝支付-构建支付表单并提交</h3><p>前端：pay.html</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_095739.png" alt></p>
<p>alipay.html这里和微信支付是一样的，也是采用的轮询方式对支付结果进行查询。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_101051.png" alt></p>
<p>还有一个页面是：alipayTempTransit.html，这个页面主要是获得支付宝构建的支付表单。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_103545.png" alt></p>
<p>向支付宝网关发送一个form提交的表单请求，然后支付宝网关返回一个页面。而微信是生成一个二维码让我们扫描的，这是和微信不一样的。</p>
<p>向支付中心发起请求之后，支付中心向支付宝网关发送请求，支付中心相当于中间人。</p>
<p>支付中心源码：<br>1、查询订单详情</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_104330.png" alt></p>
<p>2、获得初始化的AlipayClient</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_104209.png" alt></p>
<p>这里的设置的值，和微信支付一样，用的@PropertySource注解关联的一个alipay.properties文件进行属性值注入的。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_110350.png" alt></p>
<p>appID、商户私钥和支付宝公钥是商户在和支付宝签约之后，可以获取的。</p>
<p>实际上，这里的所有参数在支付宝的官网也都是有的，比如这是支付宝官网给出的一个demo:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_105613.png" alt></p>
<p>3、设置请求参数：这里除了和微信支付一样有异步通知页面路径notifyUrl，还比微信支付多了一个页面跳转同步通知页面路径returnUrl。<img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_104626.png" alt></p>
<p>4、将上述参数写成json格式：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_104704.png" alt></p>
<p>5、向支付宝执行这个请求：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_104800.png" alt></p>
<p>这里说明一下，使用支付宝和微信支付的时候，需要引入相应的依赖：<br><img src="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89%5C2021-06-02_104950.png" alt></p>
<p><img src="/2021/05/24/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%89%EF%BC%89%5C2021-06-02_104958.png" alt></p>
<p>测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_164752.png" alt></p>
<p>支付之后：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_165051.png" alt></p>
<p>这里需要说明的是，前端源码有个地方需要注意：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_164632.png" alt></p>
<p>这两句代码顺序不能变，如果变了的话，在重定向之后，open的代码是无效的。</p>
<h3 id="支付宝支付-异步通知与同步通知"><a href="#支付宝支付-异步通知与同步通知" class="headerlink" title="支付宝支付-异步通知与同步通知"></a>支付宝支付-异步通知与同步通知</h3><p>异步通知：</p>
<p>1、首先将请求参数取出来，包装成一个map.</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_171805.png" alt></p>
<p>2、验签</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_172416.png" alt></p>
<p>3、如果验证成功的话，支付中心的订单状态发生修改，并且通知商户修改订单状态。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_172502.png" alt></p>
<p>同步通知：直接关闭页面，因为不能以同步通知为准，而是以异步通知为准。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_173225.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_185510.png" alt></p>
<h3 id="定时任务-构建定时任务task"><a href="#定时任务-构建定时任务task" class="headerlink" title="定时任务-构建定时任务task"></a>定时任务-构建定时任务task</h3><p>使用Springboot的注解：@Scheduled</p>
<p>写一个配置类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_190920.png" alt></p>
<p>同时在主配置类里面开启注解：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_191253.png" alt></p>
<p>cron参数里面的内容参考网站：<a href="https://cron.qqe2.com/，设置好里面的参数之后，把cron表达式复制到代码里就行了。" target="_blank" rel="noopener">https://cron.qqe2.com/，设置好里面的参数之后，把cron表达式复制到代码里就行了。</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_190439.png" alt></p>
<p>启动项目，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_191243.png" alt></p>
<h3 id="定时任务-定时关闭超期未支付订单"><a href="#定时任务-定时关闭超期未支付订单" class="headerlink" title="定时任务-定时关闭超期未支付订单"></a>定时任务-定时关闭超期未支付订单</h3><p>1、写Service接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_193534.png" alt></p>
<p>2、写ServiceImpl实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_193611.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_193624.png" alt></p>
<p>3、在配置类里面注入service接口，然后调用closeOrder方法。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_193724.png" alt></p>
<p>这里是三秒钟就执行一次，我们改成每小时执行一次：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_194311.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_194241.png" alt></p>
<h3 id="定时任务-定时任务弊端与优化方案"><a href="#定时任务-定时任务弊端与优化方案" class="headerlink" title="定时任务-定时任务弊端与优化方案"></a>定时任务-定时任务弊端与优化方案</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-06-02_195411.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">单体电商项目架构，开发与上线（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-14 10:49:57" itemprop="dateCreated datePublished" datetime="2021-05-14T10:49:57+08:00">2021-05-14</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="实现电商首页轮播图功能"><a href="#实现电商首页轮播图功能" class="headerlink" title="实现电商首页轮播图功能"></a>实现电商首页轮播图功能</h3><p>首先来看轮播图的数据库表：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_105732.png" alt></p>
<p>关于这张表有几点说明：</p>
<p>1、背景色：这是为了配合轮播的图片显示，网页两边的背景色需要和图片的颜色保持一致。</p>
<p>2、商品id：用户点击轮播图中的某一张图的时候，会跳转到相应的商品详情页面，对应商品id。</p>
<p>3、商品分类id：用户点击了商品分类之后，显示的就是商品分类id下的所有商品。</p>
<p>4、轮播图类型：用于判断，可以根据商品id或者分类进行页面跳转，1：商品 2：分类</p>
<p>接下来实现轮播图的功能</p>
<p>1、还是从Service开始写，先写接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_132540.png" alt></p>
<p>2、写接口实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_132629.png" alt></p>
<p>可以看到这里有一个排序，按照sort进行降序排序，可以查看数据库，sort其实就是几个整数。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_132731.png" alt></p>
<p>3、写Controller。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_132917.png" alt></p>
<p>这里还是加上swagger的注解，类上加@Api，方法上加@ApiOperation。测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_133205.png" alt></p>
<p>轮播图正常显示！</p>
<p>如果这里忘记写@RequestMapping(“index”)，轮播图是不会显示的，必须和前端请求的后端地址保持一致：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_133330.png" alt></p>
<p>现在来看下前端源码，前端实际上采用的是innerHtml的方式渲染轮播图的。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_133603.png" alt></p>
<h3 id="首页分类需求分析"><a href="#首页分类需求分析" class="headerlink" title="首页分类需求分析"></a>首页分类需求分析</h3><p>首先来看下关于分类的表：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_134433.png" alt></p>
<p>我们在首页加载分类信息的时候，可以采用懒加载的方式！没必要一下子就把所有的子类都加载出来，只需要加载大分类即可，当鼠标移动到相应的大分类时，再将该大分类下的所有子分类加载出来。</p>
<p>参考淘宝网，也是采用的懒加载的方式：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_135223.png" alt></p>
<p>总结一下：首页分类展示需求：</p>
<p>1、第一次刷新主页查询大分类，渲染展示到首页。</p>
<p>2、如果鼠标上移到大分类，则加载其子分类的内容，如果已经存在子分类，则不需要加载（懒加载）。</p>
<h3 id="加载与渲染大分类"><a href="#加载与渲染大分类" class="headerlink" title="加载与渲染大分类"></a>加载与渲染大分类</h3><p>1、写Service接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_142704.png" alt></p>
<p>2、写Service实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_142729.png" alt></p>
<p>这里用到了一个枚举类，表示是拿一个级别的分类，有一级分类，二级分类，三级分类。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_142906.png" alt></p>
<p>3、写Controller。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_142939.png" alt></p>
<p>4、重启项目，测试，大分类已经成功展示！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_143020.png" alt></p>
<h3 id="分类实现-子连接查询子分类"><a href="#分类实现-子连接查询子分类" class="headerlink" title="分类实现-子连接查询子分类"></a>分类实现-子连接查询子分类</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> f.<span class="string">`id`</span> <span class="keyword">AS</span> <span class="keyword">id</span>, f.<span class="string">`type`</span> <span class="keyword">AS</span> <span class="keyword">TYPE</span>, f.<span class="string">`name`</span> <span class="keyword">AS</span> <span class="keyword">NAME</span>, f.<span class="string">`father_id`</span> <span class="keyword">AS</span> fatherId,</span><br><span class="line">	c.<span class="string">`id`</span> <span class="keyword">AS</span> subId, c.<span class="string">`type`</span> <span class="keyword">AS</span> <span class="keyword">subType</span>, c.<span class="string">`name`</span> <span class="keyword">AS</span> subName, c.<span class="string">`father_id`</span> <span class="keyword">AS</span> subFatherId</span><br><span class="line"> <span class="keyword">FROM</span> <span class="keyword">category</span> f <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">category</span> c <span class="keyword">ON</span> f.<span class="string">`id`</span> = c.<span class="string">`father_id`</span> <span class="keyword">WHERE</span> f.father_id=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_144816.png" alt></p>
<h3 id="自定义mapper实现懒加载子分类展示"><a href="#自定义mapper实现懒加载子分类展示" class="headerlink" title="自定义mapper实现懒加载子分类展示"></a>自定义mapper实现懒加载子分类展示</h3><p>实现思路：我们可以将三级分类封装成一个list放在二级分类中，然后被带向前端展示。</p>
<p>1、因此，可以将二级分类和三级分类分别封装成VO类（V表示View），这里的属性最好和数据库里查出来的保持一致。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171032.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171158.png" alt></p>
<p>2、写Mapper的方法，这里由于我们需要写一个联表查询的sql，因此使用我们通用Mapper生成的Mapper不够了，于是需要自定义Mapper:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171259.png" alt></p>
<p>3、写Mapper.xml里面的复杂SQL。实际上这里的sql就是上一节写的sql。这里复杂sql的写法值得学习！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.wyqian.mapper.CategoryMapperCustom"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myCategoryVO"</span> <span class="attr">type</span>=<span class="string">"com.wyqian.pojo.vo.CategoryVO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"type"</span> <span class="attr">property</span>=<span class="string">"type"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"fatherId"</span> <span class="attr">property</span>=<span class="string">"fatherId"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            collection 标签：用于定义关联的list集合类型的封装规则</span></span><br><span class="line"><span class="comment">            property：对应三级分类的list属性名</span></span><br><span class="line"><span class="comment">            ofType：集合的类型，三级分类的vo</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"subCatList"</span> <span class="attr">ofType</span>=<span class="string">"com.wyqian.pojo.vo.SubCategoryVO"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"subId"</span> <span class="attr">property</span>=<span class="string">"subId"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"subType"</span> <span class="attr">property</span>=<span class="string">"subType"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"subName"</span> <span class="attr">property</span>=<span class="string">"subName"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"subFatherId"</span> <span class="attr">property</span>=<span class="string">"subFatherId"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getSubCatList"</span> <span class="attr">resultMap</span>=<span class="string">"myCategoryVO"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            f.`id` AS id,</span><br><span class="line">            f.`type` AS type,</span><br><span class="line">            f.`name` AS name,</span><br><span class="line">            f.`father_id` AS fatherId,</span><br><span class="line">            c.`id` AS subId,</span><br><span class="line">            c.`type` AS subType,</span><br><span class="line">            c.`name` AS subName,</span><br><span class="line">            c.`father_id` AS subFatherId</span><br><span class="line">        FROM</span><br><span class="line">            category f</span><br><span class="line">        LEFT JOIN</span><br><span class="line">            category c</span><br><span class="line">        ON</span><br><span class="line">            f.`id` = c.`father_id`</span><br><span class="line">        WHERE</span><br><span class="line">            f.father_id = #&#123;rootCatId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171653.png" alt></p>
<p>5、写Service接口实现：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171806.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171758.png" alt></p>
<p>6、写接口:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_171857.png" alt></p>
<p>这里GetMapping里面的地址是根据前端源码得来的，相关前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_172024.png" alt></p>
<p>7、Swagger测试:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_172143.png" alt></p>
<p>8、重新install一下maven项目，重启项目测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210519172256.png" alt></p>
<h3 id="商品推荐-需求分析与sql查询"><a href="#商品推荐-需求分析与sql查询" class="headerlink" title="商品推荐-需求分析与sql查询"></a>商品推荐-需求分析与sql查询</h3><p>这一块主要用到了三张表：category、items、items_img</p>
<p>做三张表的联表查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	f.id <span class="keyword">as</span> rootCatId,</span><br><span class="line">	f.<span class="string">`name`</span> <span class="keyword">as</span> rootCatName,</span><br><span class="line">	f.slogan <span class="keyword">as</span> slogan,</span><br><span class="line">	f.cat_image <span class="keyword">as</span> catImage,</span><br><span class="line">	f.bg_color <span class="keyword">as</span> bgColor,</span><br><span class="line">	i.id <span class="keyword">as</span> itemId,</span><br><span class="line">	i.item_name <span class="keyword">as</span> itemName,</span><br><span class="line">	ii.url <span class="keyword">as</span> itemUrl,</span><br><span class="line">	ii.created_time <span class="keyword">as</span> createdName</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	<span class="keyword">category</span> f</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	items i</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	f.id = i.root_cat_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	items_img ii</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	i.id = ii.item_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	f.type = <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">	i.root_cat_id = <span class="number">7</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">	ii.is_main = <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">	i.created_time </span><br><span class="line"><span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-19_212947.png" alt></p>
<h3 id="商品推荐-实现接口与联调"><a href="#商品推荐-实现接口与联调" class="headerlink" title="商品推荐-实现接口与联调"></a>商品推荐-实现接口与联调</h3><p>可以按照之前懒加载子分类的方法，将6条最新商品的简单数据的内容封装成一个list放在一个大分类下。</p>
<p>1、封装出来的类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_095338.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_095353.png" alt></p>
<p>2、写Mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_095500.png" alt></p>
<p>这里使用了一个Map来存数据，万能的Map!</p>
<p>3、写Mapper.xml文件的内容，SQL可以把前一节的拿过来稍加修改即可！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myNewItemsVO"</span> <span class="attr">type</span>=<span class="string">"com.wyqian.pojo.vo.NewItemsVO"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"rootCatId"</span> <span class="attr">property</span>=<span class="string">"rootCatId"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"rootCatName"</span> <span class="attr">property</span>=<span class="string">"rootCatName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"slogan"</span> <span class="attr">property</span>=<span class="string">"slogan"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"catImage"</span> <span class="attr">property</span>=<span class="string">"catImage"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"bgColor"</span> <span class="attr">property</span>=<span class="string">"bgColor"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"simpleItemList"</span> <span class="attr">ofType</span>=<span class="string">"com.wyqian.pojo.vo.SimpleItemVO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"itemId"</span> <span class="attr">property</span>=<span class="string">"itemId"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemName"</span> <span class="attr">property</span>=<span class="string">"itemName"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"itemUrl"</span> <span class="attr">property</span>=<span class="string">"itemUrl"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getSixNewItemsLazy"</span> <span class="attr">resultMap</span>=<span class="string">"myNewItemsVO"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        f.id as rootCatId,</span><br><span class="line">        f.`name` as rootCatName,</span><br><span class="line">        f.slogan as slogan,</span><br><span class="line">        f.cat_image as catImage,</span><br><span class="line">        f.bg_color as bgColor,</span><br><span class="line">        i.id as itemId,</span><br><span class="line">        i.item_name as itemName,</span><br><span class="line">        ii.url as itemUrl,</span><br><span class="line">        ii.created_time as createdName</span><br><span class="line">    FROM</span><br><span class="line">    	category f</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items i</span><br><span class="line">    ON</span><br><span class="line">   		f.id = i.root_cat_id</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items_img ii</span><br><span class="line">    ON</span><br><span class="line">    	i.id = ii.item_id</span><br><span class="line">    WHERE</span><br><span class="line">    	f.type = 1</span><br><span class="line">    AND</span><br><span class="line">    	i.root_cat_id = #&#123;paramsMap.root_cat_id&#125;</span><br><span class="line">    AND</span><br><span class="line">    	ii.is_main = 1</span><br><span class="line">    ORDER BY</span><br><span class="line">    	i.created_time</span><br><span class="line">    DESC</span><br><span class="line">    LIMIT 0,6</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_095831.png" alt></p>
<p>5、写Service实现：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_095916.png" alt></p>
<p>6、写Controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_095955.png" alt></p>
<h3 id="搜索-商品详情功能分析"><a href="#搜索-商品详情功能分析" class="headerlink" title="搜索-商品详情功能分析"></a>搜索-商品详情功能分析</h3><p>这里主要涉及四张表：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_125904.png" alt></p>
<p>对应地：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_125938.png" alt></p>
<p>在后端的话，其实有两种方式：</p>
<ol>
<li>在前端发起1次请求，然后这四块信息在一个controller里面完成。</li>
<li>在前端发起4次请求，然后用4个controller返回。</li>
</ol>
<p>第一种方法避免用户过多的重复刷新，导致后端过多的请求，可以让用户在一次请求中将全部信息都查询出来。第二种方法理论上来讲的话加载起来的话更快一些，局部会优先加载出来。</p>
<h3 id="搜索-编写商品相关查询service"><a href="#搜索-编写商品相关查询service" class="headerlink" title="搜索-编写商品相关查询service"></a>搜索-编写商品相关查询service</h3><p>虽然详情页涉及了四张表，但由于都是单表查询，所以只需要使用通用Mapper即可。</p>
<p>1、先写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_133241.png" alt></p>
<p>2、写Service实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemServiceImpl</span> <span class="keyword">implements</span> <span class="title">ItemService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemsMapper itemsMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemsImgMapper itemsImgMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemsParamMapper itemsParamMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemsSpecMapper itemsSpecMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Items <span class="title">queryItemById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> itemsMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ItemsImg&gt; <span class="title">queryItemImgList</span><span class="params">(String itemId)</span> </span>&#123;</span><br><span class="line">        Example itemsImgExp = <span class="keyword">new</span> Example(ItemsImg<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Example.Criteria criteria = itemsImgExp.createCriteria();</span><br><span class="line">        criteria.andEqualTo(<span class="string">"itemId"</span>, itemId);</span><br><span class="line">        <span class="keyword">return</span> itemsImgMapper.selectByExample(criteria);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ItemsSpec&gt; <span class="title">queryItemSpecList</span><span class="params">(String itemId)</span> </span>&#123;</span><br><span class="line">        Example itemsSpecExp = <span class="keyword">new</span> Example(ItemsSpec<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Example.Criteria criteria = itemsSpecExp.createCriteria();</span><br><span class="line">        criteria.andEqualTo(<span class="string">"itemId"</span>, itemId);</span><br><span class="line">        <span class="keyword">return</span> itemsSpecMapper.selectByExample(criteria);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ItemsParam <span class="title">queryItemParam</span><span class="params">(String itemId)</span> </span>&#123;</span><br><span class="line">        Example ItemsParam = <span class="keyword">new</span> Example(ItemsSpec<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Example.Criteria criteria = ItemsParam.createCriteria();</span><br><span class="line">        criteria.andEqualTo(<span class="string">"itemId"</span>, itemId);</span><br><span class="line">        <span class="keyword">return</span> itemsParamMapper.selectOneByExample(criteria);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="搜索-联调详情页与排查bug"><a href="#搜索-联调详情页与排查bug" class="headerlink" title="搜索-联调详情页与排查bug"></a>搜索-联调详情页与排查bug</h3><p>写controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyqian.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wyqian.pojo.Items;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.pojo.ItemsImg;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.pojo.ItemsParam;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.pojo.ItemsSpec;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.pojo.vo.ItemInfoVO;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.service.ItemService;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.utils.IMOOCJSONResult;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span>(value = <span class="string">"商品接口"</span>, tags = &#123;<span class="string">"商品信息展示的相关接口"</span>&#125;)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"items"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemsController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemService itemService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"查询商品详情"</span>, notes = <span class="string">"查询商品详情"</span>, httpMethod = <span class="string">"GET"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/info/&#123;itemId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMOOCJSONResult <span class="title">info</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @ApiParam(name = <span class="string">"itemId"</span>, value = <span class="string">"商品id"</span>, required = <span class="keyword">true</span>)</span></span></span><br><span class="line"><span class="function">            @PathVariable String itemId)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(itemId))&#123;</span><br><span class="line">            <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Items item = itemService.queryItemById(itemId);</span><br><span class="line">        List&lt;ItemsImg&gt; itemsImgList = itemService.queryItemImgList(itemId);</span><br><span class="line">        List&lt;ItemsSpec&gt; itemsSpecList = itemService.queryItemSpecList(itemId);</span><br><span class="line">        ItemsParam itemsParam = itemService.queryItemParam(itemId);</span><br><span class="line"></span><br><span class="line">        ItemInfoVO itemInfoVO = <span class="keyword">new</span> ItemInfoVO();</span><br><span class="line"></span><br><span class="line">        itemInfoVO.setItem(item);</span><br><span class="line">        itemInfoVO.setItemImgList(itemsImgList);</span><br><span class="line">        itemInfoVO.setItemSpecList(itemsSpecList);</span><br><span class="line">        itemInfoVO.setItemParams(itemsParam);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.ok(itemInfoVO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_140342.png" alt></p>
<p>在真实项目中测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/%E3%80%81.png" alt></p>
<p>会发现，只有商品基本信息显示出来了，商品图片、商品规格和商品参数都没有显示。</p>
<p>排查，先查看前端相关源码：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_142005.png" alt></p>
<p>可以看到前端取后端的参数名，而后端代码（ItemInfoVO类）则不是与之对应的参数名，多了s。这时候修改后端类的属性名，与前端保持一致：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_142218.png" alt></p>
<p>重新测试，测试成功！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_142258.png" alt></p>
<h3 id="商品评价-功能讲解与数据库设计"><a href="#商品评价-功能讲解与数据库设计" class="headerlink" title="商品评价-功能讲解与数据库设计"></a>商品评价-功能讲解与数据库设计</h3><p>这一块主要涉及的表为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_142955.png" alt></p>
<p>数据库设计说明：</p>
<ol>
<li>商品规格id，对哪一款商品的哪一个规格进行评价</li>
<li>评价等级说明：1：好评 2：中评 3：差评</li>
</ol>
<p>达到的效果为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_143123.png" alt></p>
<h3 id="商品评价-实现评价等级数量查询"><a href="#商品评价-实现评价等级数量查询" class="headerlink" title="商品评价-实现评价等级数量查询"></a>商品评价-实现评价等级数量查询</h3><p>这里主要涉及商品评价表。</p>
<p>1、我们需要传到前端的参数有评价数、好评数、中评数和差评数，因此参考前面的做法，将这几个参数封装到一个VO类中。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_155914.png" alt></p>
<p>2、写Service接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_155935.png" alt></p>
<p>3、写Service实现</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_160018.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_160011.png" alt></p>
<p>4、写Controller</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_160050.png" alt></p>
<p>5、重启项目，测试</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_155711.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_160137.png" alt></p>
<p>至于这里的好评度，是在前端计算并展示的。相关前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-20_160235.png" alt></p>
<h3 id="商品评价-编写自定义mapper查询"><a href="#商品评价-编写自定义mapper查询" class="headerlink" title="商品评价-编写自定义mapper查询"></a>商品评价-编写自定义mapper查询</h3><p>这一届内容主要就是自定义了Mapper，然后编写了sql语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryItemComments"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        ic.comment_level as commentLevel,</span><br><span class="line">        ic.content as content,</span><br><span class="line">        ic.sepc_name as sepcName,</span><br><span class="line">        ic.created_time as createdTime,</span><br><span class="line">        u.face as userFace,</span><br><span class="line">        u.nickname as nickName</span><br><span class="line">    FROM</span><br><span class="line">    	items_comments ic</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	users u</span><br><span class="line">    ON</span><br><span class="line">    	ic.user_id = u.id</span><br><span class="line">    WHERE</span><br><span class="line">    	ic.item_id = 'cake-1001'</span><br><span class="line">    	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        	AND ic.comment_level = 1</span><br><span class="line">    	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="商品评价-编写Servcice"><a href="#商品评价-编写Servcice" class="headerlink" title="商品评价-编写Servcice"></a>商品评价-编写Servcice</h3><p>1、写mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-22_215059.png" alt></p>
<p>2、写VO类，用于传递到前端。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-22_215138.png" alt></p>
<p>3、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-22_215217.png" alt></p>
<p>4、写Service实现类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-22_215240.png" alt></p>
<h3 id="商品评价-实现分页"><a href="#商品评价-实现分页" class="headerlink" title="商品评价-实现分页"></a>商品评价-实现分页</h3><p>我们可以在写sql语句的时候使用limit分页，但是不太好统一。于是我们使用mybatis的一个插件pagehelper帮助我们进行分页！</p>
<p>1、导入maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、分页插件配置，即配置yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分页插件配置</span></span><br><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="attr">helper-dialect:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">support-methods-arguments:</span> <span class="literal">true</span>  <span class="comment"># 是否支持传参</span></span><br></pre></td></tr></table></figure>

<p>3、使用分页插件，在查询前使用分页插件，原理：统一拦截sql，为其提供分页功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*page：第几页</span></span><br><span class="line"><span class="comment">*pageSize：每页显示条数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">PageHelper.startPage(page, pageSize);</span><br></pre></td></tr></table></figure>

<p>4、分页数据封装到前端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&lt;?&gt; pageList = <span class="keyword">new</span> PageInfo&lt;&gt;(list);</span><br><span class="line">PagedGridResult grid = <span class="keyword">new</span> PagedGridResult();</span><br><span class="line">grid.setPage(page);</span><br><span class="line">grid.setRows(list);</span><br><span class="line">grid.setTotal(pageList.getPages());</span><br><span class="line">grid.setRecords(pageList.getTotal());</span><br></pre></td></tr></table></figure>

<p>5、由于4这一段代码可以重复使用，所以将它提取出来作为一个公共方法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_102011.png" alt></p>
<p>6、写Controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(value = <span class="string">"查询商品评论"</span>, notes = <span class="string">"查询商品评论"</span>, httpMethod = <span class="string">"GET"</span>)</span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/comments"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> IMOOCJSONResult <span class="title">comments</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @ApiParam(name = <span class="string">"itemId"</span>, value = <span class="string">"商品id"</span>, required = <span class="keyword">true</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam String itemId,</span></span><br><span class="line"><span class="function">    @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"level"</span>, value = <span class="string">"商品评价等级"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam Integer level,</span></span><br><span class="line"><span class="function">    @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"page"</span>, value = <span class="string">"查询下一页的第几页"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam Integer page,</span></span><br><span class="line"><span class="function">    @<span class="title">ApiParam</span><span class="params">(name = <span class="string">"pageSize"</span>, value = <span class="string">"分页的每一页现实的条数"</span>, required = <span class="keyword">false</span>)</span></span></span><br><span class="line"><span class="function">    @RequestParam Integer pageSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(itemId))&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(page == <span class="keyword">null</span>)&#123;</span><br><span class="line">        page = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pageSize == <span class="keyword">null</span>)&#123;</span><br><span class="line">        pageSize = COMMENT_PAGE_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line">    PagedGridResult grid = itemService.queryPagedComments(itemId,</span><br><span class="line">                                                          level,</span><br><span class="line">                                                          page,</span><br><span class="line">                                                          pageSize);</span><br><span class="line">    <span class="keyword">return</span> IMOOCJSONResult.ok(grid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里为了做到通用性，将每一页显示的条数pagesize放在了一个类BaseController中，COMMENT_PAGE_SIZE就是这个类的属性。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_104909.png" alt></p>
<p>不过为了使用COMMENT_PAGE_SIZE，ItemsController需要继承BaseController。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_105014.png" alt></p>
<p>7、maven install之后，重启项目测试</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_105208.png" alt></p>
<h3 id="商品评价-信息脱敏"><a href="#商品评价-信息脱敏" class="headerlink" title="商品评价-信息脱敏"></a>商品评价-信息脱敏</h3><p>通常我们会让用户的一些隐私信息在网站上脱敏之后显示。比如：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_110740.png" alt></p>
<p>这里，使用一个脱敏工具类，工具类里可以设置脱敏用的字符和最长的字符使用长度。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_110619.png" alt></p>
<p>在我们的项目里，将ItemCommentVO里的nickname进行脱敏：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_110557.png" alt></p>
<p>重启项目，测试，成功实现脱敏显示!</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_110951.png" alt></p>
<h3 id="商品搜索-功能详述与sql编写"><a href="#商品搜索-功能详述与sql编写" class="headerlink" title="商品搜索-功能详述与sql编写"></a>商品搜索-功能详述与sql编写</h3><p>搜索功能展示:</p>
<p><img src="/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89%5C2021-05-23_160405.png" alt></p>
<p>从这张图可以看出，涉及商品图片、商品规格、商品名称等信息，所以一定会用到下面三张表：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_160239.png" alt></p>
<p>于是乎，编写sql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	i.id <span class="keyword">as</span> itemId,</span><br><span class="line">	i.item_name <span class="keyword">as</span> itemName,</span><br><span class="line">	i.sell_counts <span class="keyword">as</span> sellCounts,</span><br><span class="line">	ii.url <span class="keyword">as</span> imgUrl,</span><br><span class="line">	tempSpec.price_discount <span class="keyword">as</span> price</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	items i</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	items_img ii</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	i.id = ii.item_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	(</span><br><span class="line">	<span class="keyword">SELECT</span> </span><br><span class="line">		item_id, <span class="keyword">MIN</span>(price_discount) <span class="keyword">as</span> price_discount</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		items_spec</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">		item_id</span><br><span class="line">	) tempSpec</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	i.id = tempSpec.item_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	ii.is_main = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>这里对于显示价格的处理，是将每一个商品id对应的最低价先查询出来，然后将其作为一张临时表，然后left join到items表中。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_160823.png" alt></p>
<h3 id="商品搜索-实现商品搜索功能"><a href="#商品搜索-实现商品搜索功能" class="headerlink" title="商品搜索-实现商品搜索功能"></a>商品搜索-实现商品搜索功能</h3><p>1、写用于展示搜索商品列表结果的VO类，VO类中的属性就是上面sql中查询出来的字段：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_165844.png" alt></p>
<p>2、写Mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_165720.png" alt></p>
<p>3、写Mapper.xml文件，这里由于需要拼接sql，所以只能使用$，不能使用#</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"SearchItems"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span> <span class="attr">resultType</span>=<span class="string">"com.wyqian.pojo.vo.SearchItemsVO"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        i.id as itemId,</span><br><span class="line">        i.item_name as itemName,</span><br><span class="line">        i.sell_counts as sellCounts,</span><br><span class="line">        ii.url as imgUrl,</span><br><span class="line">        tempSpec.price_discount as price</span><br><span class="line">    FROM</span><br><span class="line">    	items i</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items_img ii</span><br><span class="line">    ON</span><br><span class="line">    	i.id = ii.item_id</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	(SELECT item_id, MIN(price_discount) as price_discount FROM items_spec GROUP BY item_id) tempSpec</span><br><span class="line">    ON</span><br><span class="line">    	i.id = tempSpec.item_id</span><br><span class="line">    WHERE</span><br><span class="line">    	ii.is_main = 1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">" paramsMap.keywords != null and paramsMap.keywords != '' "</span>&gt;</span></span><br><span class="line">            AND i.item_name like '%$&#123;paramsMap.keywords&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        order by</span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"paramsMap.sort == <span class="symbol">&amp;quot;</span>c<span class="symbol">&amp;quot;</span> "</span>&gt;</span></span><br><span class="line">                i.sell_counts desc</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"paramsMap.sort == <span class="symbol">&amp;quot;</span>p<span class="symbol">&amp;quot;</span> "</span>&gt;</span></span><br><span class="line">                tempSpec.price_discount asc</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                i.item_name asc</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--k:默认，代表默认排序，根据name排序--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--c:默认，根据销量排序--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--p:默认，根据价格排序--&gt;</span></span><br></pre></td></tr></table></figure>

<p>4、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_170100.png" alt></p>
<p>5、写Service实现，这里和上面展示商品评价哪里类似：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_170130.png" alt></p>
<p>6、写Controller,同理，也是和前面类似：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_170231.png" alt></p>
<p>同样的，PAGE_SIZE也是在BaseController里定义好的：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_170327.png" alt></p>
<p>7、重启项目进行测试：</p>
<p>首先是在Swagger里测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_170508.png" alt></p>
<p>然后是真实项目里的测试，测试成功！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_165627.png" alt></p>
<p><img src="/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89%5C2021-05-23_165641.png" alt></p>
<h3 id="前端业务与分类搜索业务查询"><a href="#前端业务与分类搜索业务查询" class="headerlink" title="前端业务与分类搜索业务查询"></a>前端业务与分类搜索业务查询</h3><p>前端有两个地方实现了搜索功能，一个是搜索框，另一个就是三级分类。如果点击三级子分类，那么效果和搜索框的效果是一样的，前端源码：</p>
<p>点击三级子分类搜索：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_171927.png" alt></p>
<p>点击搜索框的搜索按钮：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_171959.png" alt></p>
<p>进入到catItems.html中，会对searchType进行一个判断，是searchItems还是catItems，相关源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_172455.png" alt></p>
<p>作为架构师就应该想到，这两个搜索的后端代码是放在一个Service里去写还是放在两个Service里去写呢？</p>
<p>答案当然是分开写比较好！当业务量增大的时候，分开写能够降低耦合度，对接口性能会有提升！</p>
<p>因此，可以开始写代码了！首先，Mapper.xml，复制前面搜索框的Mapper.xml中的代码，稍加修改一下，即把if去掉，加上一个and语句。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"SearchItemsByThirdCat"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span> <span class="attr">resultType</span>=<span class="string">"com.wyqian.pojo.vo.SearchItemsVO"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        i.id as itemId,</span><br><span class="line">        i.item_name as itemName,</span><br><span class="line">        i.sell_counts as sellCounts,</span><br><span class="line">        ii.url as imgUrl,</span><br><span class="line">        tempSpec.price_discount as price</span><br><span class="line">    FROM</span><br><span class="line">    	items i</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items_img ii</span><br><span class="line">    ON</span><br><span class="line">    	i.id = ii.item_id</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	(SELECT item_id, MIN(price_discount) as price_discount FROM items_spec GROUP BY item_id) tempSpec</span><br><span class="line">    ON</span><br><span class="line">    	i.id = tempSpec.item_id</span><br><span class="line">    WHERE</span><br><span class="line">    	ii.is_main = 1</span><br><span class="line">    AND</span><br><span class="line">    	id.cat_id = #&#123;paramsMap.catId&#125;</span><br><span class="line">    order by</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"paramsMap.sort == <span class="symbol">&amp;quot;</span>c<span class="symbol">&amp;quot;</span> "</span>&gt;</span></span><br><span class="line">            i.sell_counts desc</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"paramsMap.sort == <span class="symbol">&amp;quot;</span>p<span class="symbol">&amp;quot;</span> "</span>&gt;</span></span><br><span class="line">            tempSpec.price_discount asc</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            i.item_name asc</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="商品搜索-实现分类搜索商品查询"><a href="#商品搜索-实现分类搜索商品查询" class="headerlink" title="商品搜索-实现分类搜索商品查询"></a>商品搜索-实现分类搜索商品查询</h3><p>这里的步骤和代码几乎和前面根据关键字搜索是一模一样的，只是前面是根据关键字，这里是根据三级分类id。</p>
<p>1、Mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_195015.png" alt></p>
<p>2、Mapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"SearchItemsByThirdCat"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span> <span class="attr">resultType</span>=<span class="string">"com.wyqian.pojo.vo.SearchItemsVO"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        i.id as itemId,</span><br><span class="line">        i.item_name as itemName,</span><br><span class="line">        i.sell_counts as sellCounts,</span><br><span class="line">        ii.url as imgUrl,</span><br><span class="line">        tempSpec.price_discount as price</span><br><span class="line">    FROM</span><br><span class="line">    	items i</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items_img ii</span><br><span class="line">    ON</span><br><span class="line">    	i.id = ii.item_id</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	(SELECT item_id, MIN(price_discount) as price_discount FROM items_spec GROUP BY item_id) tempSpec</span><br><span class="line">    ON</span><br><span class="line">    	i.id = tempSpec.item_id</span><br><span class="line">    WHERE</span><br><span class="line">    	ii.is_main = 1</span><br><span class="line">    AND</span><br><span class="line">    	i.cat_id = #&#123;paramsMap.catId&#125;</span><br><span class="line">    order by</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"paramsMap.sort == <span class="symbol">&amp;quot;</span>c<span class="symbol">&amp;quot;</span> "</span>&gt;</span></span><br><span class="line">            i.sell_counts desc</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"paramsMap.sort == <span class="symbol">&amp;quot;</span>p<span class="symbol">&amp;quot;</span> "</span>&gt;</span></span><br><span class="line">            tempSpec.price_discount asc</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            i.item_name asc</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_195124.png" alt></p>
<p>4、写Service接口实现：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_195150.png" alt></p>
<p>5、写Controller</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_195223.png" alt></p>
<p>6、测试：</p>
<p>Swagger测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_194755.png" alt></p>
<p>真实项目测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_194729.png" alt></p>
<h3 id="购物车-购物车的存储形式"><a href="#购物车-购物车的存储形式" class="headerlink" title="购物车-购物车的存储形式"></a>购物车-购物车的存储形式</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_200537.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_200746.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_200922.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_201123.png" alt></p>
<h3 id="购物车-未登录已登录加入购物车业务代码讲解"><a href="#购物车-未登录已登录加入购物车业务代码讲解" class="headerlink" title="购物车-未登录已登录加入购物车业务代码讲解"></a>购物车-未登录已登录加入购物车业务代码讲解</h3><p>在前端的话，用的是cookie存储购物车数据，同时，如果用户处于登陆状态，则将用户购物车数据同步到后端redis，这里暂时先没用redis，所以先将其打印了出来：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_210332.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_210949.png" alt></p>
<p>相关前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-23_211226.png" alt></p>
<h3 id="购物车-渲染（刷新）购物车（上）"><a href="#购物车-渲染（刷新）购物车（上）" class="headerlink" title="购物车-渲染（刷新）购物车（上）"></a>购物车-渲染（刷新）购物车（上）</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_112840.png" alt></p>
<p>所谓渲染购物车，就是从后端拿到数据然后加载到前端。</p>
<p>这里主要就是将商品的规格从后端数据库中查询出来，然后返回到前端。</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	t_items.id <span class="keyword">as</span> itemId,</span><br><span class="line">	t_items_img.url <span class="keyword">as</span> itemImgUrl,</span><br><span class="line">	t_items.item_name <span class="keyword">as</span> itemName,</span><br><span class="line">	t_items_spec.id <span class="keyword">as</span> specId,</span><br><span class="line">	t_items_spec.<span class="string">`name`</span> <span class="keyword">as</span> specName,</span><br><span class="line">	t_items_spec.price_discount <span class="keyword">as</span> priceDiscount,</span><br><span class="line">	t_items_spec.price_normal <span class="keyword">as</span> priceNormal</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	items_spec t_items_spec</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	items t_items</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	t_items.id = t_items_spec.item_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	items_img t_items_img</span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line">	t_items_img.item_id = t_items.id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	t_items_img.is_main = <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">	t_items_spec.id <span class="keyword">IN</span></span><br><span class="line">	(<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="string">'5'</span>)</span><br></pre></td></tr></table></figure>

<p>这里没有写数量，因为数量存储在cookies，可以直接拿得到。</p>
<h3 id="购物车-渲染（刷新）购物车（下）"><a href="#购物车-渲染（刷新）购物车（下）" class="headerlink" title="购物车-渲染（刷新）购物车（下）"></a>购物车-渲染（刷新）购物车（下）</h3><p>1、写Mapper接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_161843.png" alt></p>
<p>2、写Mapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryItemsBySpecIds"</span> <span class="attr">parameterType</span>=<span class="string">"List"</span> <span class="attr">resultType</span>=<span class="string">"com.wyqian.pojo.vo.ShopcartVO"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">        t_items.id as itemId,</span><br><span class="line">        t_items_img.url as itemImgUrl,</span><br><span class="line">        t_items.item_name as itemName,</span><br><span class="line">        t_items_spec.id as specId,</span><br><span class="line">        t_items_spec.`name` as specName,</span><br><span class="line">        t_items_spec.price_discount as priceDiscount,</span><br><span class="line">        t_items_spec.price_normal as priceNormal</span><br><span class="line">    FROM</span><br><span class="line">    	items_spec t_items_spec</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items t_items</span><br><span class="line">    ON</span><br><span class="line">    	t_items.id = t_items_spec.item_id</span><br><span class="line">    LEFT JOIN</span><br><span class="line">    	items_img t_items_img</span><br><span class="line">    ON</span><br><span class="line">    	t_items_img.item_id = t_items.id</span><br><span class="line">    WHERE</span><br><span class="line">    	t_items_img.is_main = 1</span><br><span class="line">    AND</span><br><span class="line">    	t_items_spec.id IN</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"paramsList"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">item</span>=<span class="string">"specId"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;specId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里使用了foreach来遍历List里面的specId。</p>
<p>3、写Service接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_162030.png" alt></p>
<p>4、写Service接口实现：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_162104.png" alt></p>
<p>5、写Controller：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_162139.png" alt></p>
<p>6、重启项目测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_162436.png" alt></p>
<h3 id="购物车-选中商品的计算业务"><a href="#购物车-选中商品的计算业务" class="headerlink" title="购物车-选中商品的计算业务"></a>购物车-选中商品的计算业务</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_162901.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_163004.png" alt></p>
<p><img src="/2021/05/14/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%BA%8C%EF%BC%89%5C2021-05-24_163109.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_163424.png" alt></p>
<h3 id="购物车-删除商品业务讲解"><a href="#购物车-删除商品业务讲解" class="headerlink" title="购物车-删除商品业务讲解"></a>购物车-删除商品业务讲解</h3><p>考虑两种情况：</p>
<ol>
<li>用户未登录，只需要将浏览器cookie里面的相关数据删除即可。</li>
<li>用户已登录，就需要将后端购物车相关的数据一并删除。保证前后端业务数据的同步。</li>
</ol>
<p>针对第一种情况，首先删除cookie里面有关购物车的数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_164008.png" alt></p>
<p>然后将页面上的的相关项删除：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_164148.png" alt></p>
<p>如果是第二种情况，还需要将redis里面的购物车商品数据删除：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_164629.png" alt></p>
<p>在后端，controller要先写好，防止前端访问的时候出现404。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_170104.png" alt></p>
<h3 id="购物车-提交购物车至结算页"><a href="#购物车-提交购物车至结算页" class="headerlink" title="购物车-提交购物车至结算页"></a>购物车-提交购物车至结算页</h3><p>这里会有一种情况，就是未登录情况下，点击结算，这时候会跳转到登录页面。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_170852.png" alt></p>
<p>这里有一个returnUrl，如果有这一项的话，那么点击登录之后就会跳转到结算页。相关前端源码为：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_170537.png" alt></p>
<p>那么我们肯定是要将购物车数据拿到结算页进行渲染的。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_171754.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-24_171808.png" alt></p>
<p>其中，selectedItemSpecIds就是从购物车页面带到结算页面的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/05/08/RequestBody%E8%AF%A6%E8%A7%A3/RequestBody%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/08/RequestBody%E8%AF%A6%E8%A7%A3/RequestBody%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">@RequestBody详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-08 09:33:38" itemprop="dateCreated datePublished" datetime="2021-05-08T09:33:38+08:00">2021-05-08</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/08/RequestBody%E8%AF%A6%E8%A7%A3/RequestBody%E8%AF%A6%E8%A7%A3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/08/RequestBody%E8%AF%A6%E8%A7%A3/RequestBody%E8%AF%A6%E8%A7%A3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="RequestBody介绍"><a href="#RequestBody介绍" class="headerlink" title="@RequestBody介绍"></a>@RequestBody介绍</h3><p>​    1、@RequestBody主要<strong><em>用来接收前端传递给后端的json字符串中的数据</em></strong>的（请求体中的数据）。由于<strong><em>GET方式没有请求体</em></strong>，所以使用@RequestBody接受数据的时候，前端不能用GET方式提交数据，而是用<strong><em>POST方式</em></strong>提交。</p>
<p>​    2、在后端的同一个接口中，@RequestBody和@ResquestParam()可以同时使用，@RequestBody最多只能有一个，而@ResquestParam()可以有多个。</p>
<p>​    3、@RequestBody 接收的是<strong><em>请求体</em></strong>里面的数据；而@RequestParam接收的是<strong><em>key-value</em></strong>里面的参数。</p>
<p>​    4、如果参数前写了@RequestParam(xxx)，那么前端必须有对应的xxx名字才行(不管其是否有值，当然可以通过设置该注解的required属性来调节是否必须传)，如果没有xxx名的话，那么请求会出错，报400。</p>
<p>​    5、如果参数前不写@RequestParam(xxx)的话，那么就前端可以有可以没有对应的xxx名字才行，如果有xxx名的话，那么就会自动匹配；没有的话，请求也能正确发送。</p>
<p>如果后端参数是一个对象，且该参数前是以@RequestBody修饰的，那么前端传递json参数时，必须满足以下要求：</p>
<ul>
<li>后端@RequestBody注解对应的类在将HTTP的输入流(含请求体)装配到目标类(即：@RequestBody后面的类)时，会根据json字符串中的key来匹配对应实体类的属性。</li>
<li>json字符串中，如果value为””的话，后端对应的属性如果是String类型的，那么接收到的就是””;如果后端属性是Integer、Double类型的话，后端接收到的就是null。</li>
<li>json字符串中，如果value为null的话，后端对应收到的就是null。</li>
</ul>
<p>测试：</p>
<p>准备工作：</p>
<p>1、新建一个SpringBoot项目</p>
<p>2、写一个pojo类：User</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_101428.png" alt></p>
<p>由于这里无需进行数据库操作，所以直接写接口：</p>
<p>1、@RequestBody直接用<strong><em>String</em></strong>去接收前端传过来的json数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_101531.png" alt></p>
<p>测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_101327.png" alt></p>
<p>2、@RequestBody以<strong><em>简单对象</em></strong>接收前端传过来的json数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_101940.png" alt></p>
<p>测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_101918.png" alt></p>
<p>3、@RequestBody以<strong><em>复杂对象</em></strong>接收前端传过来的json数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/20180709160616858.png" alt></p>
<p>4、@RequestBody和@RequestParam()同时使用：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_103035.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_103001.png" alt></p>
<p>5、@RequestBody接收请求体中的json数据；不加注解接收URL中的数据并组装为对象，不加注解就相当于是@RequestParam。</p>
<p>但是如果是@RequestParam(“token”)，那么前端一定要有对应的字段才行，否则会报错！</p>
<p>测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_103902.png" alt></p>
<p>没带token，请求之后报错！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_103810.png" alt></p>
<p>总结：</p>
<p>​    后端@RequestBody注解对应的类在将HTTP的输入流(含请求体)装配到目标类(即:@RequestBody后面的类)时，会根据json字符串中的key来匹配对应实体类的属性，如果匹配一致且json中的该key对应的值 符合(或可转换为)实体类的对应属性的类型要求时，会调用实体类的setter方法将值赋给该属性。</p>
<p>@RequestParam:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_105907.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/05/06/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/06/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/" class="post-title-link" itemprop="url">枚举类讲解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-06 15:16:59" itemprop="dateCreated datePublished" datetime="2021-05-06T15:16:59+08:00">2021-05-06</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/06/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/06/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/%E6%9E%9A%E4%B8%BE%E7%B1%BB%E8%AE%B2%E8%A7%A3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>632</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="枚举类初探"><a href="#枚举类初探" class="headerlink" title="枚举类初探"></a>枚举类初探</h3><p>百度百科：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_151846.png" alt></p>
<p>一个简单的枚举类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_151943.png" alt></p>
<p>输出结果：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_152021.png" alt></p>
<h3 id="枚举类产生之前"><a href="#枚举类产生之前" class="headerlink" title="枚举类产生之前"></a>枚举类产生之前</h3><p>在不使用枚举类之前，我们对“春夏秋冬”四个值分别赋一个值的话，通常会这样写：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_152200.png" alt></p>
<p>上述方法定义十分繁琐，而且容易出错。例如我们定义的int数字出现重复，编译器也不会给出任何的警示。同时，这样的操作是实在太频繁了，最终Java 5中增加了枚举类型。</p>
<p>而是用枚举类型后，一切就变成了如下所示的简单几行：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_152417.png" alt></p>
<p>java自动给按照枚举类出现的顺序，从0开始分配了编号，通过<strong><em>name()</em></strong>可以获得枚举值的名称，通过<strong><em>ordinal()</em></strong>可以获得枚举值的编号。</p>
<h3 id="枚举实现原理"><a href="#枚举实现原理" class="headerlink" title="枚举实现原理"></a>枚举实现原理</h3><p>我们在定义枚举类的时候并没有定义name()和ordinal()方法。点击name()，发现进入了一个抽象类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_152703.png" alt></p>
<p>我们的Season类就是继承了这样的一个抽象类：Enum</p>
<p>我们对Season类进行反编译：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_161029.png" alt></p>
<p>可以看到：</p>
<ol>
<li>枚举类反编译之后生成了一个扩展了java.lang.Enum的类</li>
<li>枚举类是final的，因此我们无法再继承了</li>
<li>我们定义的每个枚举值都是该类的一个成员，且成员类型仍然是Season类型。</li>
<li>枚举类中被默认增加了许多的静态方法，例如：values()。</li>
</ol>
<p><strong><em>编译器帮助我们生成每个枚举值的对象!</em></strong></p>
<p>我们在总结一下，我们使用enum定义的枚举类型，会在编译之后转化为一个继承了java.lang.Enum的类，而我们定义的每个枚举值都会在类的初始化阶段被实例化为我们所定义的枚举类的一个对象。</p>
<p>同时，编译器还帮我们在类中增加了两个方法，分别是：values()和valueOf()。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/04/27/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/27/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">单体电商项目架构，开发与上线（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-27 19:26:42" itemprop="dateCreated datePublished" datetime="2021-04-27T19:26:42+08:00">2021-04-27</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/04/27/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/04/27/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>26 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h3 id="大型网站架构演进历程"><a href="#大型网站架构演进历程" class="headerlink" title="大型网站架构演进历程"></a>大型网站架构演进历程</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_142151.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_142234.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_142725.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_142813.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_142851.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_143022.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_143045.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_143106.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_143143.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_143213.png" alt></p>
<h3 id="架构师所需具备的技术栈与能力"><a href="#架构师所需具备的技术栈与能力" class="headerlink" title="架构师所需具备的技术栈与能力"></a>架构师所需具备的技术栈与能力</h3><p>技术栈：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_143420.png" alt></p>
<p>能力：</p>
<ul>
<li>技术全面，有广度</li>
<li>关注前沿技术</li>
<li>全局观、预判</li>
<li>把控团队，忙而不乱</li>
<li>系统分解与模块拆分</li>
<li>指导与培训</li>
<li>沟通与协调能力</li>
<li>抽象、举例、画图</li>
<li>软技能</li>
</ul>
<h3 id="前后端技术选型"><a href="#前后端技术选型" class="headerlink" title="前后端技术选型"></a>前后端技术选型</h3><p><strong>后端技术选型</strong>  SpringBoot   VS    SpringMVC</p>
<ul>
<li>SpringMVC是框架，是Spring的子集，是Spring的一个模块</li>
<li>SpringBoot是工具（配置工具、整合工具）</li>
<li>从繁琐配置（xml）到零配置（yml）</li>
<li>SpringBoot集成了多样化中间件【*-starter】,一定程度上简化了maven的配置</li>
<li>从外置tomcat变为内置tomcat</li>
</ul>
<p>聊一聊Struts</p>
<ul>
<li>安全漏洞，对于技术选型来讲的话，安全性是一定需要考虑的问题。</li>
<li>请求变量共享，当用户请求变多的话，由于Action的线程安全问题，导致Action的一些变量可能会出现共享的情况。</li>
<li>Filter拦截。SpringMVC、SpringBoot是通过AOP实现的，但是Struts是通过类拦截</li>
<li>非Spring官方自产自销，当Struts与Spring结合的时候，会略显得有点重。</li>
</ul>
<p><strong>前端技术选型</strong></p>
<ul>
<li>MVVM开发模式，去DOM，不是通过DOM去操作结点</li>
<li>Jquery、Vue.js（渐进式框架）</li>
<li>html</li>
<li>css</li>
</ul>
<p>技术选型所要考虑的</p>
<ul>
<li>切合业务</li>
<li>社区活跃度</li>
<li>团队技术水平</li>
<li>版本更新迭代周期（例如Dubbo停更了一段时间）</li>
<li>试错精神</li>
<li>安全性</li>
<li>开源精神</li>
</ul>
<h3 id="前后端分离开发模式"><a href="#前后端分离开发模式" class="headerlink" title="前后端分离开发模式"></a>前后端分离开发模式</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_151253.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_151626.png" alt></p>
<h3 id="项目分层设计原则"><a href="#项目分层设计原则" class="headerlink" title="项目分层设计原则"></a>项目分层设计原则</h3><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_152033.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_152329.png" alt></p>
<h3 id="构建聚合工程"><a href="#构建聚合工程" class="headerlink" title="构建聚合工程"></a>构建聚合工程</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>packaging默认是jar类型，pom、jar、war区别：</p>
<p><a href="https://blog.csdn.net/imaginehero/article/details/103706732" target="_blank" rel="noopener">https://blog.csdn.net/imaginehero/article/details/103706732</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        1、聚合工程里可以分为顶级项目（顶级工程、父工程）与子工程，这两者的关系其实就是父子继承的关系</span></span><br><span class="line"><span class="comment">        子工程在maven里称之为模块（module），模块之间是平级的，是可以相互依赖的。</span></span><br><span class="line"><span class="comment">        2、子模块可以使用顶级工程里所有的资源（依赖），子模块之间如果要使用资源，必须构建依赖（构建关系，把pom坐标拿过来）</span></span><br><span class="line"><span class="comment">        3、一个顶级工程是可以由多个不同的子工程共同组合而成。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p>foodie-dev-common   pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>foodie-dev-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>foodie-dev-pojo   pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在pojo中引入common的依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wyqian<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>foodie-dev-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>foodie-dev-mapper pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            mapper-&gt;pojo-&gt;common</span></span><br><span class="line"><span class="comment">            mapper通过pojo是可以使用common中相应的方法的</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wyqian<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>foodie-dev-pojo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>foodie-dev-service pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            service -&gt; mapper -&gt; pojo -&gt; common</span></span><br><span class="line"><span class="comment">            service是可以使用pojo和common中相应的方法的</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wyqian<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>foodie-dev-mapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>foodie-dev-api  pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            common-mail</span></span><br><span class="line"><span class="comment">            api -&gt; service -&gt; mapper -&gt; pojo -&gt; common</span></span><br><span class="line"><span class="comment">            api -&gt; common-mail</span></span><br><span class="line"><span class="comment">            api是可以使用service、pojo和common中相应的方法的</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wyqian<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>foodie-dev-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在引入每一个子模块的时候，需要看一下顶级工程里面<modules></modules>里面是不是添加进去了这个子模块，在引入上述这么多子模块之后，顶级工程中 pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>foodie-dev-common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>foodie-dev-pojo<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>foodie-dev-mapper<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>foodie-dev-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>foodie-dev-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在引入子模块完成之后，需要安装一下，建立各个模块之间的依赖关系。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_162955.png" alt></p>
<h3 id="PDMan数据库建模工具的使用"><a href="#PDMan数据库建模工具的使用" class="headerlink" title="PDMan数据库建模工具的使用"></a>PDMan数据库建模工具的使用</h3><p>我们在真实的业务开发的时候，不会直接在数据库管理工具中创建表，PDMan提供了这样的一个功能，并且出去展示的时候，不可能直接将数据库展示给用户看，PDMan这样的数据库建模工具就显得比较专业。</p>
<p>PDMan下载官网：<a href="http://pdman.cn/#/，无脑安装即可。" target="_blank" rel="noopener">http://pdman.cn/#/，无脑安装即可。</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_170847.png" alt></p>
<p>连接自己的数据库</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_171338.png" alt></p>
<p>同步数据库</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_171516.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_171755.png" alt></p>
<h3 id="生产环境增量与全量脚本迭代"><a href="#生产环境增量与全量脚本迭代" class="headerlink" title="生产环境增量与全量脚本迭代"></a>生产环境增量与全量脚本迭代</h3><p>重建数据库：新建一张临时表，将当前数据复制到临时表中，然后删除旧表并新建表（把新的字段加上），将数据复制过去！</p>
<p>字段增量：修改原数据库字段。</p>
<p>生产环境中应选择<strong>字段增量</strong>！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_201049.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-28_200716.png" alt></p>
<h3 id="数据库物理外键移除原因"><a href="#数据库物理外键移除原因" class="headerlink" title="数据库物理外键移除原因"></a>数据库物理外键移除原因</h3><p>加外键的好处：1、数据库的完整性；2、强调了数据的强一致性</p>
<p>数据库外键：</p>
<ul>
<li>性能影响。在大并发的情况下，物理外键一定会影响数据库的性能。</li>
<li>热更新。热更新就是指不停机进行更新。外键会导致新更新上去的一些代码无法运行，因为需要去匹配现有的一些外键！这时候就需要去重启服务器！</li>
<li>降低耦合度。删除物理外键，用逻辑外键代替！</li>
<li>数据库分库分表。有外键的话，难以实现分库分表。</li>
</ul>
<p>总结：在设计一个传统的小型项目的时候，物理外键可以存在，但是在设计一个大型互联网项目的时候是绝对不能存在物理外键的！</p>
<h3 id="聚合工程整合SpringBoot"><a href="#聚合工程整合SpringBoot" class="headerlink" title="聚合工程整合SpringBoot"></a>聚合工程整合SpringBoot</h3><p>在父项目的pom中引入下面的依赖。使之变成SpringBoot项目，spring-boot-starter-parent中管理了我们很多需要的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后添加编码相关的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后从parent中取得下面的依赖，可以看到在parent中已经管理好了版本，这里就不需要加版本信息。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                排除spring-boot-starter-logging的jar包，因为后续我们会引入其他的日志工具！</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            springboot默认会解析yml文件，加上这个依赖，就可以解析别的配置文件！</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>让项目跑起来：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_193432.png" alt></p>
<p>在Controller中写一个HelloController类测试一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World~"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试成功页面：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_193540.png" alt></p>
<h3 id="SpringBoot自动装配简述"><a href="#SpringBoot自动装配简述" class="headerlink" title="SpringBoot自动装配简述"></a>SpringBoot自动装配简述</h3><p>点开主启动类下面的run方法：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_193908.png" alt></p>
<p>点开@SpringBootApplication注解：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_194500.png" alt></p>
<p>点开@SpringBootConfiguration注解：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_194911.png" alt></p>
<p><strong><em>SpringBoot怎么实现自动装配的？</em></strong>—-&gt;spring.factories</p>
<p>点开@EnableAutoConfiguration–&gt;AutoConfigurationImportSelector</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_200224.png" alt></p>
<p>比如说在SpringBoot中内置的Tomcat是怎么启动的？</p>
<p>打开spring.factories，有一个类叫做EmbeddedWebServerFactoryCustomizerAutoConfiguration，打开：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_200617.png" alt></p>
<p>点开Tomcat类，可以发现里面有Tomcat所有的操作！这里相当于是配置Tomcat</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_200647.png" alt></p>
<p>回到spring.factories，点开ServletWebServerFactoryAutoConfiguration类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_200931.png" alt></p>
<p>spring.factories中还有WebMvcAutoConfiguration这样的类，帮我们配置好了MVC模块，我们才不用像以前在SpringMVC那样配置XML文件！</p>
<h3 id="HikariCP数据源简述"><a href="#HikariCP数据源简述" class="headerlink" title="HikariCP数据源简述"></a>HikariCP数据源简述</h3><p>HikariCP官网：<a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="noopener">https://github.com/brettwooldridge/HikariCP</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_202204.png" alt></p>
<p>SpringBoot默认的数据源。</p>
<p>SpringBoot中已经自动装配好了HikariCP数据源，可以做到开箱即用(无需导入依赖)，如果是在SpringMVC中用，需要导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为什么HikariCP很快：<a href="https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole" target="_blank" rel="noopener">https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole</a></p>
<ul>
<li>把ArrayList换成了自定义的FastList</li>
<li>有一个并发包：ConcurrentBag–&gt;无锁设计</li>
<li>invokevirtual被invokestatic替换掉了，使得更容易被JVM优化。另外：getstatic回调没有了。另外：invokevirtual被invokestatic替换掉了，堆栈从5个减少到了4个。</li>
</ul>
<p><em>HikariCP</em>和<em>Druid</em>的对比：</p>
<ul>
<li>功能角度考虑，Druid 功能更全面，除具备连接池基本功能外，还支持sql级监控、扩展、SQL防注入等。最新版甚至有集群监控。</li>
<li>单从性能角度考虑，从数据上确实HikariCP要强，但Druid有更多、更久的生产实践，它可靠。</li>
<li>单从监控角度考虑，如果我们有像skywalking、prometheus等组件是可以将监控能力交给这些的 HikariCP也可以将metrics暴露出去。</li>
</ul>
<h3 id="数据层HikariCP与Mybatis整合"><a href="#数据层HikariCP与Mybatis整合" class="headerlink" title="数据层HikariCP与Mybatis整合"></a>数据层HikariCP与Mybatis整合</h3><p>1、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--MySQL驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Mybatis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、使用PDMan工具将表导入到数据库中，在application.yml中配置数据源和Mybatis：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># web访问端口号  约定8088</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8088</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">uri-encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">  <span class="attr">max-http-header-size:</span> <span class="string">80KB</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 配置数据源信息</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="comment"># 数据源的相关配置</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span> <span class="comment"># 数据源类型：HikariCP</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span> <span class="comment"># mysql驱动</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/foodie-shop-dev?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">30000</span> <span class="comment"># 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQ</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">5</span> <span class="comment"># 最小连接数</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span> <span class="comment"># 最大连接数</span></span><br><span class="line">      <span class="attr">auto-commit:</span> <span class="literal">true</span> <span class="comment"># 自动提交</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">600000</span> <span class="comment"># 连接超时的最大时长（毫秒），超时则被释放（retired），默认:10分钟</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">DateSourceHikariCP</span> <span class="comment"># 连接池名字</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">1800000</span> <span class="comment"># 连接的生命时长（毫秒），超时而且没被使用则被释放（retired），默认:30分钟</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># mybatis 配置</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.wyqian.pojo</span> <span class="comment"># 所有POJO类所在包路径</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span> <span class="comment"># mapper映射文件</span></span><br></pre></td></tr></table></figure>

<p>3、测试项目是否运行正常。maven需要重新install。重启服务后会出现：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_212451.png" alt></p>
<p>这是因为在导入的时候，加了一句：排除SpringBoot自带的日志工具</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以暂时把这一段注释掉，重启服务，成功！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-29_213317.png" alt></p>
<h3 id="数据源连接数详解"><a href="#数据源连接数详解" class="headerlink" title="数据源连接数详解"></a>数据源连接数详解</h3><p><strong><em>maximum-pool-size</em></strong>：最大连接数。不是越大越好，而是根据服务器来的。比如服务器4核，可以设置为10，如果为8核，则可以设置为20。默认设置为10</p>
<p><strong><em>minimum-idle</em></strong>：最小连接数。作者是希望和最大连接数保持一致。但是为了不被闲置，可以设置一个小一点的数。</p>
<p>一般可以将这两个数设置成一样！也可以maximum-pool-size设置为大一些，minimum-idle设置为小一些。比如：maximum-pool-size设为20，minimum-idle设为5或者10.</p>
<h3 id="MyBatis-数据库逆向生成工具"><a href="#MyBatis-数据库逆向生成工具" class="headerlink" title="MyBatis 数据库逆向生成工具"></a>MyBatis 数据库逆向生成工具</h3><p> <img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-01_125306.png" alt></p>
<p>首先会有一个通用Mapper:  MyMapper类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyMapper</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">T</span>&gt;, <span class="title">MySqlMapper</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>generatorConfig.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"MysqlContext"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3Simple"</span> <span class="attr">defaultModelType</span>=<span class="string">"flat"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"beginningDelimiter"</span> <span class="attr">value</span>=<span class="string">"`"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"endingDelimiter"</span> <span class="attr">value</span>=<span class="string">"`"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 通用mapper所在目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">"tk.mybatis.mapper.generator.MapperPlugin"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappers"</span> <span class="attr">value</span>=<span class="string">"com.imooc.my.mapper.MyMapper"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost:3306/foodie-shop-dev"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">"123456"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 对应生成的pojo所在包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.imooc.pojo"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 对应生成的mapper所在目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"mapper"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/resources"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 配置mapper对应的java映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.imooc.mapper"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库表 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"carousel"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"category"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"users"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"user_address"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"items"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"items_img"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"items_spec"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"items_param"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"items_comments"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"orders"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"order_items"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"order_status"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行GeneratorDisplay</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.mybatis.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorDisplay</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generator</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		<span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">		<span class="comment">//指定 逆向工程配置文件</span></span><br><span class="line">		File configFile = <span class="keyword">new</span> File(<span class="string">"generatorConfig.xml"</span>);</span><br><span class="line">		ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">		Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">		DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">		MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config,</span><br><span class="line">				callback, warnings);</span><br><span class="line">		myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			GeneratorDisplay generatorSqlmap = <span class="keyword">new</span> GeneratorDisplay();</span><br><span class="line">			generatorSqlmap.generator();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-01_141148.png" alt></p>
<p>tk-Mybatis和Mabatis-plus类似，可以极大地提高我们的开发效率。</p>
<h3 id="关于Restful-webservice的那些事儿"><a href="#关于Restful-webservice的那些事儿" class="headerlink" title="关于Restful webservice的那些事儿"></a>关于Restful webservice的那些事儿</h3><h4 id="Restful-Web-Service"><a href="#Restful-Web-Service" class="headerlink" title="Restful Web Service"></a>Restful Web Service</h4><ul>
<li>通信方式，比如说RPC通信，Restful也是一种通信方式。</li>
<li>信息传递</li>
<li>无状态。所有的请求对于接口来说都是无状态的</li>
<li>独立性</li>
</ul>
<h4 id="Rest设计规范"><a href="#Rest设计规范" class="headerlink" title="Rest设计规范"></a>Rest设计规范</h4><ul>
<li>GET  获取资源信息的  也就是查询的操作</li>
<li>POST  保存信息和更新资源   也可以处理一些批量的操作</li>
<li>PUT  更新资源操作</li>
<li>DELETE  删除操作</li>
</ul>
<p>URL里面不能出现一些动词，如果是动词，转换成名词！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-02_122648.png" alt></p>
<h3 id="基于通用Mapper基于Rest编写api接口-1"><a href="#基于通用Mapper基于Rest编写api接口-1" class="headerlink" title="基于通用Mapper基于Rest编写api接口-1"></a>基于通用Mapper基于Rest编写api接口-1</h3><p>新建一张学生信息表：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-02_213922.png" alt></p>
<p>1、利用之前的mybatis-generator代码生成器，生成pojo、mapper.xml文件和StuMapper.java文件，并拷贝到我们的项目中。</p>
<p>2、写service。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-02_214225.png" alt></p>
<p>3、写Controller。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StuFooController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StuService stuService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/getStu"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Stu <span class="title">getStu</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuService.getStuInfo(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是直接这样启动会报错，原因是mapper并未扫描到我们的Spring中，这时候要在主启动类上加上一条注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//扫描mybatis通用mapper下所在的包</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.wyqian.mapper"</span>)</span><br></pre></td></tr></table></figure>

<p>注意@MapperScan要选：tk包下的</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/1619963132(1).png" alt></p>
<p>4、测试成功：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-02_214625.png" alt></p>
<p>另：由于idea的原因，导致这里会出现红线：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_091028.png" alt></p>
<p>为了去除红线，可以在settings里面设置一下：</p>
<p>搜索Inspections—–&gt;Spring  去掉Autowiring for bean class的方框勾选即可。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_091233.png" alt></p>
<h3 id="基于通用Mapper基于Rest编写api接口-2"><a href="#基于通用Mapper基于Rest编写api接口-2" class="headerlink" title="基于通用Mapper基于Rest编写api接口-2"></a>基于通用Mapper基于Rest编写api接口-2</h3><p>同理，完善保存、更新和删除学生的部分</p>
<p>1、写service.</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_102636.png" alt></p>
<p>2、写Controller.</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_091947.png" alt></p>
<p>这里需要注意的是，我们按照Restful设计规范，查询操作使用GetMapping，保存、更新和删除操作使用PostMapping。</p>
<p>谈谈<strong><em>幂等性</em></strong>：<br>幂等性：就是用户对于同一操作发起的一次请求或者多次请求的结果是一致的，不会因为多次点击而产生了副作用。</p>
<p>在我们这里，更新操作和删除操作是具备幂等性的，但是保存就不具备幂等性了，因为每次保存都有可能是不一样的值。</p>
<h3 id="使用PostMan调试Restful接口"><a href="#使用PostMan调试Restful接口" class="headerlink" title="使用PostMan调试Restful接口"></a>使用PostMan调试Restful接口</h3><p>我们使用的PostMapping接口，是不可以直接使用浏览器进行调试的，但是可以借用调试工具，比如说PostMan。</p>
<p>下载地址：<a href="https://www.postman.com/downloads/" target="_blank" rel="noopener">https://www.postman.com/downloads/</a></p>
<p>1、Get请求</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_100149.png" alt></p>
<p>2、Post请求—保存操作</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_100326.png" alt></p>
<p>去数据库中查看一下，数据已经持久化完成：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_100314.png" alt></p>
<p>多次重复同一个请求：<a href="http://localhost:8088/saveStu：" target="_blank" rel="noopener">http://localhost:8088/saveStu：</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_100539.png" alt></p>
<p>3、Post请求—更新操作</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_102721.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_102731.png" alt></p>
<p>4、Post请求—删除操作</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_102826.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_102837.png" alt></p>
<p>彩蛋：ctrl+F12可以将当前类中的方法、属性以列表的形式展示出来！</p>
<h3 id="详解事务的传播"><a href="#详解事务的传播" class="headerlink" title="详解事务的传播"></a>详解事务的传播</h3><p><strong><em>@Transactional</em></strong></p>
<p>默认值：<img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_103248.png" alt></p>
<h4 id="REQUIRED"><a href="#REQUIRED" class="headerlink" title="REQUIRED"></a>REQUIRED</h4><p><strong>Propagation.REQUIRED</strong>：一定要使用事务，如果没有的话就创建事务，如果有的话就使用当前的事务。</p>
<p>准备工作：</p>
<p>1、先写一个TestTransactionalService 接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_112836.png" alt></p>
<p>2、在StuServiceImpl中实现TestTransactionalService接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_113003.png" alt></p>
<p>3、写一下TestTransactionalServiceImpl，将saveParent()和saveChildren()引入：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_113129.png" alt></p>
<p>测试：</p>
<p>1、首先，父Service和子Service都不加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错误，数据库中2条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_113503.png" alt></p>
<p>2、父Sercice加事务，子Service不加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错误，数据库中没有数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_113730.png" alt></p>
<p>3、父Service不加事务，子Service加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错误，数据库中有1条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_114040.png" alt></p>
<p>总结：</p>
<p>REQUIRED：使用当前的事务，如果没有加入事务，则自己新建一个事务，子方法是必须运行在一个事务的，如果当前存在事务，则加入这个事务，成为一个整体。</p>
<p>举例：领导没饭吃，我有钱，我会自己买了自己吃；领导有的吃，会分给你一起吃。</p>
<h4 id="SUPPORTS"><a href="#SUPPORTS" class="headerlink" title="SUPPORTS"></a>SUPPORTS</h4><p>测试：</p>
<p>1、父Service不加事务，子Service加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错误，数据库中有2条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_114953.png" alt></p>
<p>2、父Service加事务，子Service加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错误，数据库中没有数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_115145.png" alt></p>
<p>总结：如果当前有事务，则使用事务；如果当前没有事务，则不使用事务。</p>
<p>举例：领导没饭吃，我也没饭吃；领导有饭吃，我也有饭吃。</p>
<h4 id="MANDATORY"><a href="#MANDATORY" class="headerlink" title="MANDATORY"></a>MANDATORY</h4><p>测试：</p>
<p>1、父Service不加事务，子Service加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.MANDATORY)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报错：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_115909.png" alt></p>
<p>这是由于父Service不加事务所导致的。</p>
<p>数据库中有1条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_120012.png" alt></p>
<p>2、父Service加事务，子Service加事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.MANDATORY)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中没有数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-03_120140.png" alt></p>
<p>总结：该传播属性强制必须存在一个事务，如果不存在，则抛出异常。</p>
<p>举例：领导必须管饭，不管饭没饭吃，我就不乐意了，就不干了（抛出异常）。</p>
<h4 id="REQUIRES-NEW"><a href="#REQUIRES-NEW" class="headerlink" title="REQUIRES_NEW"></a>REQUIRES_NEW</h4><p>测试：</p>
<p>1、父Service不加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中有1条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_153313.png" alt></p>
<p>2、父Service加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>并修改一下除零错的位置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>&#123;</span><br><span class="line">    saveChild1();</span><br><span class="line">    <span class="comment">//int i = 1 / 0;</span></span><br><span class="line">    saveChild2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>&#123;</span><br><span class="line">    stuService.saveParent();</span><br><span class="line">    stuService.saveChildren();</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中有2条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_153659.png" alt></p>
<p>如果将子Service上的<code>REQUIRES_NEW</code>改为<code>REQUIRED</code>的话，那么数据库中就没有数据！这就是<code>REQUIRES_NEW</code>和<code>REQUIRED</code>的区别。</p>
<p>总结：如果当前有事务，则挂起该事务，并且自己创建一个新的事务给自己使用；</p>
<p>如果没有事务，则同REQUIRED。</p>
<p>举例：领导有饭吃，我偏不要，我自己买了自己吃。</p>
<h4 id="NOT-SUPPORTED"><a href="#NOT-SUPPORTED" class="headerlink" title="NOT_SUPPORTED"></a>NOT_SUPPORTED</h4><p>1、父Service不加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NOT_SUPPORTED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中有2条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_154839.png" alt></p>
<p>2、父Service加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NOT_SUPPORTED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中有1条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_155049.png" alt></p>
<p>总结：如果当前有事务，则把事务挂起，自己不使用事务去运行数据库操作。</p>
<p>举例：领导有饭吃，分一点你给你，我太忙了，放一边，我不吃。</p>
<h4 id="NEVER"><a href="#NEVER" class="headerlink" title="NEVER"></a>NEVER</h4><p>1、父Service加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NEVER)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_164337.png">

<p>数据库中没有数据。</p>
<p>2、父Service不加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NEVER)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中有2条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_164657.png" alt></p>
<p>总结：如果当前有事务存在，则抛出异常</p>
<p>举例：领导有饭吃，我不想吃，我热爱工作，我抛出异常！</p>
<h4 id="NESTED"><a href="#NESTED" class="headerlink" title="NESTED"></a>NESTED</h4><p>1、父Service不加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NESTED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中有1条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_165830.png" alt></p>
<p>2、父Service加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NESTED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>并修改一下除零错的位置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>&#123;</span><br><span class="line">    saveChild1();</span><br><span class="line">    <span class="comment">//int i = 1 / 0;</span></span><br><span class="line">    saveChild2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>&#123;</span><br><span class="line">    stuService.saveParent();</span><br><span class="line">    stuService.saveChildren();</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果报除零错，数据库中没有数据！</p>
<p>3、父Service加事务，子Service加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">父Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>;</span><br><span class="line">子Service：</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.NESTED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>再修改一下除零错的位置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveChildren</span><span class="params">()</span></span>&#123;</span><br><span class="line">    saveChild1();</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">    saveChild2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>&#123;</span><br><span class="line">    stuService.saveParent();</span><br><span class="line">    stuService.saveChildren();</span><br><span class="line">    <span class="comment">//int i = 1 / 0;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果还是没有数据！</p>
<p>4、在3的基础上使用try catch设置保存点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropagationTrans</span><span class="params">()</span></span>&#123;</span><br><span class="line">    stuService.saveParent();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        stuService.saveChildren();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//int i = 1 / 0;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行代码，结果正确，并且数据库中有一条数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_170538.png" alt></p>
<p>总结：如果当前有事务，则开启子事务（嵌套事务），嵌套事务可以独立提交或者回滚；</p>
<p>如果当前没有事务，则同REQUIRED；</p>
<p>但是如果主事务提交，则会携带子事务一起提交。</p>
<p>如果主事务回滚，则子事务会一起回滚。相反，子事务异常，则父事务可以回滚或不回滚。</p>
<p>举例：领导决策不对，老板怪罪，领导带着小弟一同受罪。小弟出了差错，领导可以推卸责任。</p>
<h3 id="为何不使用-EnableTransactionManagement就能使用事务？"><a href="#为何不使用-EnableTransactionManagement就能使用事务？" class="headerlink" title="为何不使用@EnableTransactionManagement就能使用事务？"></a>为何不使用@EnableTransactionManagement就能使用事务？</h3><p>所谓开启事务管理，就是：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_183539.png" alt></p>
<p>但是，我们在讲事务传播的时候并没有加这条注解，但是事务依然生效，这是因为SpringBoot帮我们自动注入了事务管理！</p>
<p>spring.factories中：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_183313.png" alt></p>
<p>TransactionAutoConfiguration配置类中可以看到它通过Spring  AOP实现的。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_184015.png" alt></p>
<h3 id="详细讲解注册登录流程"><a href="#详细讲解注册登录流程" class="headerlink" title="详细讲解注册登录流程"></a>详细讲解注册登录流程</h3><p>实现单体电商项目核心功能：</p>
<ul>
<li>用户注册与登录</li>
<li>Cookie与Session</li>
<li>集成Swagger2 api</li>
<li>分类设计与实现</li>
<li>首页商品推荐</li>
<li>商品搜索与分页</li>
<li>商品详情与评论渲染</li>
<li>购物车与订单</li>
<li>微信和支付宝支付</li>
</ul>
<h4 id="用户注册和登录流程"><a href="#用户注册和登录流程" class="headerlink" title="用户注册和登录流程"></a>用户注册和登录流程</h4><p>一般有3种方式：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_185215.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_185542.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-05_185708.png" alt></p>
<h3 id="用户注册-判断用户名存在"><a href="#用户注册-判断用户名存在" class="headerlink" title="用户注册-判断用户名存在"></a>用户注册-判断用户名存在</h3><p>密码与确认密码不一致，前后端都要做！</p>
<ul>
<li><p>前端做的话是为了减轻服务端的压力</p>
</li>
<li><p>后端做的话是为了防止某些用户绕过前端，直接访问服务器，如果服务端没有做验证的话，就可能造成黑客的攻击。</p>
</li>
</ul>
<p>在集群、微服务、分布式的环境下，所有的表id必须全局唯一！除非表的访问量非常非常小，表的数据量只有十几条，几十条，上百上千这种可以使用自增长。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_134157.png" alt></p>
<p>我们应该从底层往上写：</p>
<p>1、新建一个UserService，</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_142152.png" alt></p>
<p>2、实现UserServiceImpl</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_142227.png" alt></p>
<p>3、写接口PassportController</p>
<p>这里用到了一个apache的工具类，判断字符串是否为空。所以要先导包：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_142434.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_142319.png" alt></p>
<h3 id="自定义响应数据结构"><a href="#自定义响应数据结构" class="headerlink" title="自定义响应数据结构"></a>自定义响应数据结构</h3><p>写好了接口之后，测试！</p>
<p>由于我们修改了服务端代码，所以需要重新安装各个模块之间的关系，install一下！</p>
<p>会发现报错了：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_142735.png" alt></p>
<p>这是由于maven在install的时候会帮我们把测试（junit）下的跑一下，所以这里我们将相关测试代码注释掉：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_143128.png" alt></p>
<p>再次install，BUILD SUCCESS!</p>
<p>启动Application，报错：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_144928.png" alt></p>
<p>springboot的事务默认是使用jdk的动态代理，即基于接口。而在注入***Impl的时候是实现类，所以我们将代理模式改成基于实现类的代理模式：</p>
<p>只需要在主启动类上将：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br></pre></td></tr></table></figure>

<p>改成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span>(proxyTargetClass=<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_145707.png" alt></p>
<p>修改之后，再次测试，成功！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_144648.png" alt></p>
<p>这里的返回值都是写死的，在RESTFUL Service里面其实是返回的状态码，于是乎，可以将代码修改一下：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_150226.png" alt></p>
<p>这里，HttpStatus是一个枚举类。再次测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_150426.png" alt></p>
<p>这里返回OK，可以看源码：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_150349.png" alt></p>
<p>在后端的话，我们可以将状态码和一些业务数据封装在一起。</p>
<p>于是，写了一个工具类：IMOOCJSONResult.java</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_170017.png" alt></p>
<p>这个类中主要的属性只有三个，这样我们就可以将响应的状态、响应消息和响应的数据封装在一起，前端可以自行根据业务需求调用。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_170149.png" alt></p>
<p>因此，我们将Controller中的内容再做修改：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_170131.png" alt></p>
<p>install maven项目，重启，再次测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_170449.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-06_170539.png" alt></p>
<h3 id="用户注册-创建用户Service"><a href="#用户注册-创建用户Service" class="headerlink" title="用户注册-创建用户Service"></a>用户注册-创建用户Service</h3><p>1、完成Service接口部分：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_214133.png" alt></p>
<p>这里使用UserBO，是将前端传过来的Json Object封装成了一个Java类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_214244.png" alt></p>
<p>2、写Service的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Users <span class="title">createUser</span><span class="params">(UserBO userBO)</span> </span>&#123;</span><br><span class="line">    Users user = <span class="keyword">new</span> Users();</span><br><span class="line">    <span class="comment">//设置用户id</span></span><br><span class="line">    String userId  = sid.nextShort();</span><br><span class="line">    user.setId(userId);</span><br><span class="line">    <span class="comment">//设置用户名</span></span><br><span class="line">    user.setUsername(userBO.getUsername());</span><br><span class="line">    <span class="comment">//设置密码</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        user.setPassword(MD5Utils.getMD5Str(userBO.getPassword()));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//默认昵称同用户名</span></span><br><span class="line">    user.setNickname(userBO.getUsername());</span><br><span class="line">    <span class="comment">//设置默认头像</span></span><br><span class="line">    user.setFace(USER_FACE);</span><br><span class="line">    <span class="comment">//设置生日</span></span><br><span class="line">    user.setBirthday(DateUtil.stringToDate(<span class="string">"1900-01-01"</span>));</span><br><span class="line">    <span class="comment">//设置性别</span></span><br><span class="line">    user.setSex(Sex.secret.type);</span><br><span class="line">    <span class="comment">//设置创建时间和更新时间</span></span><br><span class="line">    user.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    user.setUpdatedTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">    usersMapper.insert(user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的注意点有：</p>
<p>1、设置密码的时候需要加密，防止黑客攻击服务器的时候用户信息泄露，这里我们采用的是MD5加密方式。工具类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_214542.png" alt></p>
<p>2、用户默认头像图片地址：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER_FACE = <span class="string">"http://122.152.205.72:88/group1/M00/00/05/CpoxxFw_8_qAIlFXAAAcIhVPdSg994.png"</span>;</span><br></pre></td></tr></table></figure>

<p>3、设置生日。使用了一个工具类，将字符串转成Date格式，工具类：<br><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_214845.png" alt></p>
<p>4、设置性别。写了一个枚举类，枚举类如下：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_214950.png" alt></p>
<p>5、设置用户id，这里为了保证全局唯一，使用了工具类生成，工具类：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_215123.png" alt></p>
<p>这里需要注意两点，第1、是在Spring中注入Sid类。第2、工具类所在的包需要被SpringBoot扫描到，所以在主启动类上需要加入注解：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-07_215412.png" alt></p>
<h3 id="用户注册-创建用户controller与测试"><a href="#用户注册-创建用户controller与测试" class="headerlink" title="用户注册-创建用户controller与测试"></a>用户注册-创建用户controller与测试</h3><p>之前的passPort里面写，注意点有：</p>
<p>1、需要考虑注册不成功的几种情况：</p>
<ul>
<li>用户名和密码不能为空</li>
<li>用户名不能是已经注册过的，也就是数据库中已经存在的</li>
<li>密码必须大于6位</li>
<li>密码和确认密码必须一致</li>
</ul>
<p>2、@RequestBody的作用：</p>
<p>将前端传过来的Json Object转化成Java Class   UserBO。</p>
<p>3、由于这里是保存操作，所以使用PostMapping映射方式。</p>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/regist"</span>)</span><br><span class="line"><span class="comment">//@RequestBody作用是什么？---&gt;将前端传过来的Json Object转化成Java class</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IMOOCJSONResult <span class="title">regist</span><span class="params">(@RequestBody UserBO userBO)</span></span>&#123;</span><br><span class="line">    String username = userBO.getUsername();</span><br><span class="line">    String password = userBO.getPassword();</span><br><span class="line">    String confirmPwd = userBO.getConfirmPassword();</span><br><span class="line">    <span class="comment">//0. 用户名和密码不能为空</span></span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(username) ||</span><br><span class="line">       StringUtils.isBlank(password) ||</span><br><span class="line">       StringUtils.isBlank(confirmPwd))&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="string">"用户名和密码不能为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1. 查询用户名是否存在</span></span><br><span class="line">    <span class="keyword">boolean</span> isExist = userService.queryUserNameIsExist(username);</span><br><span class="line">    <span class="keyword">if</span>(isExist)&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="string">"用户名已经存在"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. 密码不能少于6位</span></span><br><span class="line">    <span class="keyword">if</span>(password.length() &lt; <span class="number">6</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="string">"密码不能少于6位"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 两次输入的密码必须保持一致</span></span><br><span class="line">    <span class="keyword">if</span>(!password.equals(confirmPwd))&#123;</span><br><span class="line">        <span class="keyword">return</span> IMOOCJSONResult.errorMsg(<span class="string">"两次输入的密码不一致"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4. 实现注册</span></span><br><span class="line">    userService.createUser(userBO);</span><br><span class="line">    <span class="keyword">return</span> IMOOCJSONResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：这里由于需要传递的是Json数据，在PostMan里面需要选择Body-&gt;raw-&gt;JSON。</p>
<p>1、用户名和密码为空：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_091111.png" alt></p>
<p>2、用户名已经存在：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_091619.png" alt></p>
<p>3、密码少于6位：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_091252.png" alt></p>
<p>4、两次密码不一致：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_091232.png" alt></p>
<p>5、注册成功：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-08_091607.png" alt></p>
<h3 id="整合Swagger2文档api"><a href="#整合Swagger2文档api" class="headerlink" title="整合Swagger2文档api"></a>整合Swagger2文档api</h3><p>​    为了减少程序员撰写文档时间，提高生产力，Swagger2应运而生，使用Swagger2可以减少编写过多的文档，只需要通过代码就能生成文档API，提供给前端人员对接，非常方便。</p>
<p>1、引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger2 配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一个依赖是核心。前两个依赖是官方提供的，最后一个是其他开发人员开发的。</p>
<p>2、写Swagger2配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2<span class="comment">//开启Swagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//http:localhost:8088/swagger-ui.html     原路径</span></span><br><span class="line">    <span class="comment">//http:localhost:8088/doc.html     换肤</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置Swagger2核心配置   docket</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createDocket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)                                   <span class="comment">//指定api类型为Swagger2</span></span><br><span class="line">                    .apiInfo(apiInfo())                                                  <span class="comment">//用于定义api文档汇总信息</span></span><br><span class="line">                    .select()</span><br><span class="line">                    .apis(RequestHandlerSelectors.</span><br><span class="line">                            basePackage(<span class="string">"com.wyqian.controller"</span>))                        <span class="comment">//指定controller包</span></span><br><span class="line">                    .paths(PathSelectors.any())                                          <span class="comment">//所有controller</span></span><br><span class="line">                    .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"天天吃货 电商平台接口api"</span>)         <span class="comment">//文档页标题</span></span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"wyqian"</span>,</span><br><span class="line">                        <span class="string">"http://wyqian.top/"</span>,</span><br><span class="line">                      <span class="string">"wanyun_qian@163.com"</span>)</span><br><span class="line">                        )                               <span class="comment">//联系人信息</span></span><br><span class="line">                .description(<span class="string">"专为天天吃货提供的api文档"</span>)  <span class="comment">//详细信息</span></span><br><span class="line">                .version(<span class="string">"1.0.1"</span>)                       <span class="comment">//文档版本号</span></span><br><span class="line">                .termsOfServiceUrl(<span class="string">"http://wyqian.top/"</span>)<span class="comment">//网站地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，使用了两种ui来展示，一种是Swagger自带的方式，另一种是使用了BootStrap美化后的ui。分别如下：</p>
<p><img src="/2021/04/27/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89%5C2021-05-11_202048.png" alt></p>
<p><img src="/2021/04/27/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89/H:%5Chexoblog%5Cblog%5Csource_posts%5C%E5%8D%95%E4%BD%93%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%BC%80%E5%8F%91%E4%B8%8E%E4%B8%8A%E7%BA%BF%EF%BC%88%E4%B8%80%EF%BC%89%5C2021-05-11_202057.png" alt></p>
<h3 id="优化Swagger2显示"><a href="#优化Swagger2显示" class="headerlink" title="优化Swagger2显示"></a>优化Swagger2显示</h3><p>1、如果有一些controller不想展示（比如：隐私或者测试接口等等），可以使用<code>@ApiIgnore</code>注解：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_202736.png" alt></p>
<p>在HelloController和StuFooController上面使用该注解，重启项目：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_202616.png" alt></p>
<p>另外两个接口不见了！</p>
<p>2、将英文展示变成中文展示，对开发人员更友好！</p>
<p>加在Controller类上的</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_203943.png" alt></p>
<p>加在方法上的（POST提交）：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_203950.png" alt></p>
<p>加在方法上的（GET提交）：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_203956.png" alt></p>
<p>重启，查看ui页面：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_204125.png" alt></p>
<p>3、上述请求参数展示为空，可以在pojo类里配置：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_205039.png" alt></p>
<p>重启，查看ui页面：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_205211.png" alt></p>
<h3 id="使用tomcat运行前端源码"><a href="#使用tomcat运行前端源码" class="headerlink" title="使用tomcat运行前端源码"></a>使用tomcat运行前端源码</h3><p>插曲：解决tomcat启动闪退的办法：</p>
<p>在shutup.bat和shutdown.bat的文件最前面加上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET JAVA_HOME=C:\Program Files\Java\jdk1<span class="number">.8</span><span class="number">.0_152</span></span><br><span class="line">SET TOMCAT_HOME=D:\Environment\apache-tomcat-<span class="number">9.0</span><span class="number">.39</span>-windows-x64\apache-tomcat-<span class="number">9.0</span><span class="number">.39</span></span><br></pre></td></tr></table></figure>

<p>1、将foodie-shop静态资源文件夹复制到tomcat–&gt;webapps目录下</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_211129.png" alt></p>
<p>2、启动tomcat(双击shutup.bat)，在浏览器中输入url：<a href="http://localhost:8080/foodie-shop：（文件夹名即为访问路径）" target="_blank" rel="noopener">http://localhost:8080/foodie-shop：（文件夹名即为访问路径）</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_211307.png" alt></p>
<h3 id="设置跨域配置实现前后端联调"><a href="#设置跨域配置实现前后端联调" class="headerlink" title="设置跨域配置实现前后端联调"></a>设置跨域配置实现前后端联调</h3><p>跨域：前端静态资源放在了tomcat的8080端口，而后端的代码是在8088端口，前端请求后端的时候，两个端口完全不同，这就是跨域。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_215154.png" alt></p>
<p>解决跨域问题：</p>
<p>1、前端配置后端服务地址serverurl：</p>
<p>将</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_215338.png" alt></p>
<p>修改成后端所在的接口服务地址：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-11_215511.png" alt></p>
<p>2、在后端写一个关于跨域的配置类corsConfig，允许<a href="http://localhost:8080地址的前端资源访问后端服务器。">http://localhost:8080地址的前端资源访问后端服务器。</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CorsConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//1、添加cors配置信息</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        config.addAllowedOrigin(<span class="string">"http://localhost:8080"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置是否发送cookie信息</span></span><br><span class="line">        config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置允许请求的方式</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置允许的header</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、为url添加映射路径</span></span><br><span class="line">        UrlBasedCorsConfigurationSource corsSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        corsSource.registerCorsConfiguration(<span class="string">"/**"</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、返回重新定义好的corsSource</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(corsSource);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、重启项目，测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-12_222619.png" alt></p>
<p>后端数据库中的数据：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-12_222730.png" alt></p>
<p>可以看到，当用户名输入框输入wyqian的时候，下方已经显示了用户名已经存在的红色消息，这是通过Vue中的前后端交互工具axios实现的，相关的前端源码为;</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-12_222914.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-12_223122.png" alt></p>
<h3 id="实现用户登录"><a href="#实现用户登录" class="headerlink" title="实现用户登录"></a>实现用户登录</h3><p>1、写Service接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_090450.png" alt></p>
<p>2、在UserServiceImpl类中实现上面的方法。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_090552.png" alt></p>
<p>3、写Controller，可以把前面注册的代码拿过来修改即可。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_090651.png" alt></p>
<p>这里需要注意两点：</p>
<p>1、前端拿到的password需要经过MD5加密之后与后端数据库中的数据作比较。</p>
<p>2、由于登陆操作不需要写confirmPassword，所以UserBO实体类中，将confirmPassword属性的swagger注解的required设置成false。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_091015.png" alt></p>
<p>4、maven项目重新install，重启项目。</p>
<ul>
<li><p>swagger-ui页面测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_092304.png" alt></p>
</li>
<li><p>真实项目测试也没有问题，登陆成功！</p>
</li>
</ul>
<p>这部分前端源码展示：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_092412.png" alt></p>
<p>其中，res就是从后端拿到的数据，为了查看拿到的数据，这里我们加上debugger，在浏览器中测试，可以看到res中有我们后端的IMOOCJSONResult对象数据。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210513092026.png" alt></p>
<h3 id="回顾cookie和session"><a href="#回顾cookie和session" class="headerlink" title="回顾cookie和session"></a>回顾cookie和session</h3><p>cookie:</p>
<ul>
<li>以键值对形式存储信息在浏览器，其实就是存储在浏览器上的缓存。cookie大小是有限制的，一般不能超过4KB。</li>
<li>cookie不能跨域，当前及其父级域名可以取值</li>
<li>cookie可以设置有效期</li>
<li>cookie可以设置path</li>
</ul>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_094147.png" alt></p>
<p>session:</p>
<ul>
<li>基于服务器内存的缓存（非持久化），可保存请求会话。</li>
<li>每个session通过sessionid来区分不同请求。</li>
<li>session可设置过期时间</li>
<li>session也是以键值对形式存在的。</li>
</ul>
<p>Session例子：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_100224.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_100143.png" alt></p>
<h3 id="实现用户信息在页面显示"><a href="#实现用户信息在页面显示" class="headerlink" title="实现用户信息在页面显示"></a>实现用户信息在页面显示</h3><p>通过cookie实现！</p>
<p>1、导入CookieUtils和JsonUtils工具类</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_103642.png" alt></p>
<p>2、在login接口中设置cookie。注意这里由于安全性考虑（比如说公用电脑，个人信息保存在cookie中不安全等），需要将一些属性赋为空，才能传到前端。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_103911.png" alt></p>
<p>其中，cookie名”user”是与前端对应的：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_104026.png" alt></p>
<p>3、启动测试。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210513103233.png" alt></p>
<p>4、注册的接口也加上同样的设置cookie代码。测试：</p>
<ol>
<li><p>首先退出当前登录，这里由于还没做退出登陆的功能，所以直接删除浏览器中cookie信息：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_104500.png" alt></p>
</li>
<li><p>点击注册。注册完毕后首页：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_104613.png" alt></p>
</li>
</ol>
<h3 id="整合log4j打印日志"><a href="#整合log4j打印日志" class="headerlink" title="整合log4j打印日志"></a>整合log4j打印日志</h3><p>由于springboot自带的日志框架有些冗余，我们可以剔除springboot自带的日志框架：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_111128.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_110644.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_110836.png" alt></p>
<p>添加日志框架依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入日志依赖 抽象层 与 实现层--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>引入依赖后重启项目，控制台信息：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_112124.png" alt></p>
<p>加上配置文件：log.properties，控制台消息正常！</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_112332.png" alt></p>
<p>测试日志级别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个logger</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(HelloController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">"info: hello,nju!"</span>);</span><br><span class="line">        logger.warn(<span class="string">"warn: hello,nju!"</span>);</span><br><span class="line">        logger.debug(<span class="string">"debug: hello,nju!"</span>);</span><br><span class="line">        logger.error(<span class="string">"error: hello,nju!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World~"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动项目，访问<a href="http://localhost:8088/hello，控制台消息：" target="_blank" rel="noopener">http://localhost:8088/hello，控制台消息：</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_123101.png" alt></p>
<p>可以看到日志级别为info级别的情况下，是看不到debug的消息的。重新设置，改成DEBUG：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_123358.png" alt></p>
<p>再次启动项目，访问<a href="http://localhost:8088/hello，控制台消息为：" target="_blank" rel="noopener">http://localhost:8088/hello，控制台消息为：</a></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-13_123517.png" alt></p>
<p>这时候DEBUG级别的消息也打印了出来。</p>
<h3 id="通过日志监控service执行时间"><a href="#通过日志监控service执行时间" class="headerlink" title="通过日志监控service执行时间"></a>通过日志监控service执行时间</h3><p>1、导入AOP的包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、由于通过日志监控service执行时间是通过AOP实现的，于是乎，在foodie-dev-api下新建一个aspect包，然后新建一个类，并写一个切入的方法。</p>
<p>这里采用的是环绕通知。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span><span class="comment">//标注这个类是一个切面</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLogAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * AOP通知：</span></span><br><span class="line"><span class="comment">     * 1、前置通知：在方法调用之前执行</span></span><br><span class="line"><span class="comment">     * 2、后置通知：在方法正常调用之后执行</span></span><br><span class="line"><span class="comment">     * 3、环绕通知：在方法调用之前和之后，都分别可以执行的通知</span></span><br><span class="line"><span class="comment">     * 4、异常通知：如果载方法调用过程中发生异常，则通知</span></span><br><span class="line"><span class="comment">     * 5、最终通知：在方法调用之后执行，与2区别开来，可以理解为try catch里面的finally</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log =</span><br><span class="line">            LoggerFactory.getLogger(ServiceLogAspect<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切面表达式：</span></span><br><span class="line"><span class="comment">     * execution  代表所要执行的表达式主体</span></span><br><span class="line"><span class="comment">     * 第一处 * 代表方法返回类型，*代表所有类型</span></span><br><span class="line"><span class="comment">     * 第二处 包名代表aop监控的类所在的包</span></span><br><span class="line"><span class="comment">     * 第三处 .. 代表该包及其子包下的所有类方法</span></span><br><span class="line"><span class="comment">     * 第四处 * 代表类名  *代表所有类</span></span><br><span class="line"><span class="comment">     * 第五处 *(..) *表示类中的方法名，(..)表示方法中的任何参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"execution(* com.wyqian.service.serviceImpl..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">recordTimeLog</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        log.info(<span class="string">"===== 开始执行 &#123;&#125;.&#123;&#125; ====="</span>,</span><br><span class="line">                        joinPoint.getTarget().getClass(),</span><br><span class="line">                        joinPoint.getSignature().getName());</span><br><span class="line">        <span class="comment">//记录开始时间</span></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行目标</span></span><br><span class="line">        Object result = joinPoint.proceed();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//记录结束时间</span></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> takeTime = end - start;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(takeTime &gt; <span class="number">3000</span>)&#123;</span><br><span class="line">            log.error(<span class="string">"===== 执行结束，耗时：&#123;&#125;毫秒 ====="</span>, takeTime);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(takeTime &gt; <span class="number">2000</span>)&#123;</span><br><span class="line">            log.warn(<span class="string">"===== 执行结束，耗时：&#123;&#125;毫秒 ====="</span>, takeTime);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">"===== 执行结束，耗时：&#123;&#125;毫秒 ====="</span>, takeTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里注意一个写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"execution(* com.wyqian.service.serviceImpl..*.*(..))"</span>)</span><br></pre></td></tr></table></figure>

<p>我们之前写的是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"execution(* com.wyqian.service.UserServiceImpl.*(..))"</span>)</span><br></pre></td></tr></table></figure>

<p>发现比上面的写法少了..*，这是因为serviceImpl是一个包，加..星是因为.. 代表该包及其子包下的所有类方法，而星表示所有类。而之前的写法中UserServiceImpl本身就是一个类！</p>
<p>3、重启项目，测试</p>
<ul>
<li>1、我们执行了一个登陆操作：</li>
</ul>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_094700.png" alt></p>
<ul>
<li><p>2、我们加入休眠代码，创造error和warn级别的日志。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_095046.png" alt></p>
</li>
</ul>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_095117.png" alt></p>
<p>再次测试，结果：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_095031.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_095244.png" alt></p>
<p>由于在log.properties中配置了写入到文件，所以在本地也会有日志记录：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_100939.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_101146.png" alt></p>
<h3 id="用户退出登录清空cookie"><a href="#用户退出登录清空cookie" class="headerlink" title="用户退出登录清空cookie"></a>用户退出登录清空cookie</h3><p>前端源码：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_102931.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_102554.png" alt></p>
<p>因此，我们需要在passport中新加一个logout的接口：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_102554.png" alt></p>
<p>测试：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_102812.png" alt></p>
<h3 id="开启Mybatis日志Sql打印"><a href="#开启Mybatis日志Sql打印" class="headerlink" title="开启Mybatis日志Sql打印"></a>开启Mybatis日志Sql打印</h3><p>在生产环境中，我们一般不会去打印出SQL语句，但是在开发环境中，开启SQL日志，可以帮助我们更好定位和判断哪里写错了。</p>
<p>在Mybatis的配置文件处，加上一条关于日志的配置，这里我们选择stdoutImpl:</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_104243.png" alt></p>
<p>重启项目，测试：</p>
<p>登录操作：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_104448.png" alt></p>
<p>注册操作：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-05-14_104636.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/04/26/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/26/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">阿里云短信业务实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-26 16:02:16" itemprop="dateCreated datePublished" datetime="2021-04-26T16:02:16+08:00">2021-04-26</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/04/26/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/04/26/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E4%B8%9A%E5%8A%A1%E5%AE%9E%E6%88%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h1><blockquote>
<p>了解阿里云用户权限操作</p>
</blockquote>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-26_160729.png" alt></p>
<p>1、开启子用户</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/6a39599c94c9e1e296c5071d1177ec6.png" alt></p>
<p>2、新建一个用户组，并设置添加权限 sms短信服务</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-26_162710.png" alt></p>
<p>3、创建一个用户，具体用来操作的账号</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-26_163000.png" alt></p>
<p>4、得到AccessKey（id，密码）</p>
<p><strong><em>注意：要将这个账号保存下来</em></strong></p>
<blockquote>
<p>开通阿里云短信服务</p>
</blockquote>
<p>1、找到阿里云短信服务控制台面板</p>
<p>直接在阿里云官网搜索即可。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-04-26_164949.png" alt></p>
<p>2、找到帮助文档</p>
<p><a href="https://help.aliyun.com/document_detail/102715.html?spm=5176.12212976.0.dexternal.20dd1cbepYi0UX" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/102715.html?spm=5176.12212976.0.dexternal.20dd1cbepYi0UX</a></p>
<blockquote>
<p>添加短信模板</p>
</blockquote>
<p>1、短信的具体内容</p>
<p>2、等待审核通过（需要正当的理由）</p>
<blockquote>
<p>添加签名</p>
</blockquote>
<p>1、公司的名称</p>
<p>2、等待审核通过（需要正当的理由）</p>
<blockquote>
<p>编写测试代码</p>
</blockquote>
<p>1、新建一个SpringBoot项目</p>
<p>2、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、编写代码测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyqian;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.CommonRequest;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.CommonResponse;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.DefaultAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.IAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ServerException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.http.MethodType;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.DefaultProfile;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliyunsmsdemoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接阿里云</span></span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(<span class="string">"cn-qingdao"</span>, <span class="string">"LTAI5tFdaicWmFstmbDawtTt"</span>, <span class="string">"pr6o4dhpMJfg8FwBNBkJLF6LCpDhCk"</span>);</span><br><span class="line">        IAcsClient client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建请求</span></span><br><span class="line">        CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line"></span><br><span class="line">        request.setSysMethod(MethodType.POST);</span><br><span class="line">        request.setSysDomain(<span class="string">"dysmsapi.aliyuncs.com"</span>);<span class="comment">//不要动</span></span><br><span class="line">        request.setSysVersion(<span class="string">"2017-05-25"</span>);<span class="comment">//不要动</span></span><br><span class="line">        request.setSysAction(<span class="string">"SendSms"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//自定义参数（手机号，验证码，签名，模板）</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"PhoneNumbers"</span>, <span class="string">"15573147750"</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">"SignName"</span>, <span class="string">"学习"</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateCode"</span>, <span class="string">"SMS_215802812"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建一个短信验证码</span></span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>, <span class="number">2233</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateParam"</span>, JSONObject.toJSONString(map));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            CommonResponse response = client.getCommonResponse(request);</span><br><span class="line">            System.out.println(response.getData());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ServerException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编写可复用的微服务接口，实现验证码的发送！</p>
</blockquote>
<p>Service层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyqian.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SendSms</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">send</span><span class="params">(String phoneNum, String templateCode, Map&lt;String, Object&gt; code)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service层实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyqian.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.CommonRequest;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.CommonResponse;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.DefaultAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.IAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ServerException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.http.MethodType;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.DefaultProfile;</span><br><span class="line"><span class="keyword">import</span> com.wyqian.service.SendSms;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendSmsImpl</span> <span class="keyword">implements</span> <span class="title">SendSms</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">send</span><span class="params">(String phoneNum, String templateCode, Map&lt;String, Object&gt; code)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接阿里云</span></span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(<span class="string">"cn-qingdao"</span>, <span class="string">"LTAI5tFdaicWmFstmbDawtTt"</span>, <span class="string">"pr6o4dhpMJfg8FwBNBkJLF6LCpDhCk"</span>);</span><br><span class="line">        IAcsClient client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建请求</span></span><br><span class="line">        CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line"></span><br><span class="line">        request.setSysMethod(MethodType.POST);</span><br><span class="line">        request.setSysDomain(<span class="string">"dysmsapi.aliyuncs.com"</span>);<span class="comment">//不要动</span></span><br><span class="line">        request.setSysVersion(<span class="string">"2017-05-25"</span>);<span class="comment">//不要动</span></span><br><span class="line">        request.setSysAction(<span class="string">"SendSms"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//自定义参数（手机号，验证码，签名，模板）</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"PhoneNumbers"</span>, phoneNum);</span><br><span class="line">        request.putQueryParameter(<span class="string">"SignName"</span>, <span class="string">"学习"</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateCode"</span>, templateCode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建一个短信验证码</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateParam"</span>, JSONObject.toJSONString(code));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            CommonResponse response = client.getCommonResponse(request);</span><br><span class="line">            System.out.println(response.getData());</span><br><span class="line">            <span class="keyword">return</span> response.getHttpResponse().isSuccess();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ServerException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller层实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wyqian.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wyqian.service.SendSms;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>  <span class="comment">//跨域支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsApiController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SendSms sendSms;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/send/&#123;phone&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">code</span><span class="params">(@PathVariable(<span class="string">"phone"</span>)</span> String phone)</span>&#123;</span><br><span class="line">        <span class="comment">//调用发送方法（模拟真实业务 redis）</span></span><br><span class="line">        String code = redisTemplate.opsForValue().get(phone);</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(code))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"phone : "</span> + code + <span class="string">"已存在，还没有过期"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//生成验证码并存储到Redis中</span></span><br><span class="line">        code = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        HashMap&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        param.put(<span class="string">"code"</span>, code);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isSend = sendSms.send(phone, <span class="string">"SMS_215802812"</span>, param);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">            <span class="comment">//如果发送成功，就将验证码存储到Redis中，并设置过期时间。</span></span><br><span class="line">            redisTemplate.opsForValue().set(phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"phone : "</span> + code + <span class="string">"发送成功！"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"发送失败！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/03/25/JVM%E6%8E%A2%E7%A9%B6/JVM%E6%8E%A2%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/25/JVM%E6%8E%A2%E7%A9%B6/JVM%E6%8E%A2%E7%A9%B6/" class="post-title-link" itemprop="url">JVM探究</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-25 14:25:22" itemprop="dateCreated datePublished" datetime="2021-03-25T14:25:22+08:00">2021-03-25</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/03/25/JVM%E6%8E%A2%E7%A9%B6/JVM%E6%8E%A2%E7%A9%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/03/25/JVM%E6%8E%A2%E7%A9%B6/JVM%E6%8E%A2%E7%A9%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h1 id="JVM探究"><a href="#JVM探究" class="headerlink" title="JVM探究"></a>JVM探究</h1><ul>
<li>请你谈谈你对JVM的理解？Java8虚拟机和之前的变化更新？</li>
<li>什么是OOM，什么是栈溢出 StackOverFlowError?怎么分析？</li>
<li>JVM的常用调优参数有哪些？</li>
<li>内存快照如何抓取？怎么分析Dump文件？知道吗？</li>
<li>谈谈JVM中，类加载器你的认识？rt.jar  ext  application</li>
</ul>
<ol>
<li><p>JVM的位置</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_144404.png" alt></p>
</li>
<li><p>JVM的体系机构</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_145025.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_145213.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_145320.png" alt></p>
</li>
<li><p>类加载器</p>
<p>作用：加载Class文件~new Student();</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_152622.png" alt></p>
<ol>
<li><p>虚拟机自带的加载器</p>
</li>
<li><p>启动类（根）加载器</p>
</li>
<li><p>扩展类加载器</p>
</li>
<li><p>应用程序加载器</p>
</li>
<li><p>百度：<strong><em>双亲委派机制</em></strong></p>
<p><a href="https://blog.csdn.net/codeyanbao/article/details/82875064" target="_blank" rel="noopener">https://blog.csdn.net/codeyanbao/article/details/82875064</a></p>
</li>
</ol>
</li>
<li><p>双亲委派机制</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/20201217213314510.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//双亲委派机制：安全</span></span><br><span class="line">    <span class="comment">//1.APP--&gt;EXC---Bootstrap(最终执行)</span></span><br><span class="line">    <span class="comment">//ROOT</span></span><br><span class="line">    <span class="comment">//EXC</span></span><br><span class="line">    <span class="comment">//APP</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="keyword">new</span> String();</span><br><span class="line">        System.out.println(s.toString());</span><br><span class="line">        System.out.println(s.getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. 类加载器收到类加载的请求</span></span><br><span class="line"><span class="comment">    2. 将这个请求向上委托给父类加载器去完成，一直向上委托，直到启动类加载器</span></span><br><span class="line"><span class="comment">    3. 启动加载器检查是否能够加载当前这个类，能加在就结束，使用当前的加载器，否则，抛出异常，通知子加载器进行加载</span></span><br><span class="line"><span class="comment">    4. 重复步骤3</span></span><br><span class="line"><span class="comment">    Class Not Found~</span></span><br><span class="line"><span class="comment">    null: java调用不到~ C  C++</span></span><br><span class="line"><span class="comment">    Java ==&gt; C++ 去掉了指针和内存管理，于是乎Java被称为C++--</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//类是抽象的模板，对象是具体的</span></span><br><span class="line"><span class="comment">//        Class&lt;Car&gt; carClass = Car.class;</span></span><br><span class="line"></span><br><span class="line">        Car car1 = <span class="keyword">new</span> Car();</span><br><span class="line">        Car car2 = <span class="keyword">new</span> Car();</span><br><span class="line">        Car car3 = <span class="keyword">new</span> Car();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Class&lt;? extends Car&gt; aClass = car1.getClass();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ClassLoader classLoader = aClass.getClassLoader();<span class="comment">//AppClassLoader</span></span><br><span class="line">        System.out.println(aClass.getClassLoader());</span><br><span class="line">        ClassLoader parent = classLoader.getParent();<span class="comment">//ExtClassLoader   \jre1.8.0_152\lib\ext</span></span><br><span class="line">        System.out.println(parent);</span><br><span class="line">        ClassLoader parentParent = parent.getParent();<span class="comment">//null  1.不存在   2.java程序获取不到~   rt.jar</span></span><br><span class="line">        System.out.println(parentParent);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>沙箱安全机制</p>
<p>​    Java安全模型的核心就是Java沙箱（sandbox），什么是沙箱？沙箱是一个限制程序运行的环境。沙箱机制就是将Java代码限定在虚拟机（JVM）特定的运行范围中，并且严格限制代码对本地系统资源的访问，通过这样的措施来保护对代码的有效隔离，防止对本地系统造成破坏。沙箱主要限制系统资源访问，那系统资源包括什么？CPU、内存、文件系统、网络。不同级别的沙箱对这些资源访问的限制也可以不一样。</p>
<p>​    所有的java程序都可以指定沙箱，可以定制安全策略。</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_165143.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_165219.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_165318.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_165531.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_170142.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_170419.png" alt></p>
</li>
<li><p>Native</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt; &#123;</span><br><span class="line">        &#125;, <span class="string">"my thread name"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    native：凡是带了native关键字的，说明java的范围达不到了，回去调用底层C语言的库</span></span><br><span class="line"><span class="comment">    会进入本地方法栈</span></span><br><span class="line"><span class="comment">    调用本地方法本地接口  JNI</span></span><br><span class="line"><span class="comment">    JNI作用：扩展Java的使用，融合不同的编程语言为Java所用！最初：C、C++</span></span><br><span class="line"><span class="comment">    Java诞生的时候C、C++横行，想要立足，必须要有调用C、C++的程序</span></span><br><span class="line"><span class="comment">    他在内存区域中专门开辟了一块标记区域：Native Method Stack,登记native方法</span></span><br><span class="line"><span class="comment">    在最终执行的时候，加载本地方法库中的方法通过JNI</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//java程序驱动打印机，管理系统，掌握即可，在企业级应用中较为少见！</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">start0</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用其他接口(异构领域间通信)：Socket、WebService、http</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PC寄存器</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-26_090045.png" alt></p>
</li>
<li><p>方法区</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-26_090800.png" alt></p>
</li>
<li><p>栈：数据结构</p>
<p>程序 = 数据结构 + 算法：持续学习~</p>
<p>程序 = 框架 + 业务逻辑<del>：吃饭</del></p>
<p>栈：先进后出、后进先出：桶</p>
<p>队列：先进先出（FIFO：First Input First Output）</p>
<p>喝多了吐就是栈，吃多了拉就是队列</p>
<p>为什么main()先执行，最后结束~</p>
<p>栈：栈内存，主管程序的运行，生命周期和线程同步；</p>
<p>线程结束，栈内存也就是释放了，对于栈来说，不存在垃圾回收问题</p>
<p>一旦线程结束，栈就Over!</p>
<p>栈：8大基本类型+对象引用+实例的方法</p>
<p>栈运行原理：栈帧</p>
<p>栈满了：StackOverFlowError</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-26_092948.png" alt></p>
</li>
</ol>
<p>   栈+堆+方法区   交互关系</p>
<p>   <img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-26_093341.png" alt></p>
<p>   <strong>画出一个对象实例化的过程在内存中：百度、看视频~</strong></p>
<p>   <a href="https://blog.csdn.net/Tony__Jaa/article/details/107612059" target="_blank" rel="noopener">https://blog.csdn.net/Tony__Jaa/article/details/107612059</a></p>
<ol start="10">
<li><p>三种JVM</p>
<ul>
<li>Sun公司   HotSpot</li>
<li>BEA  JRockit</li>
<li>IBM  J9VM</li>
</ul>
<p>我们学习都是：HotSpot</p>
</li>
<li><p>堆</p>
<p>Heap，一个JVM只有一个堆内存，堆内存的大小是可以调节的。</p>
<p>类加载器读取了类文件后，一般会把什么东西放到堆中呢？类，方法，常量，变量~，保存我们所有引用类型的真实对象！</p>
<p>堆内存中还要细分为三个区域：</p>
<ul>
<li>新生区  Young/New（伊甸园区）</li>
<li>养老区  old</li>
<li>永久区  Perm</li>
</ul>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-26_134802.png" alt></p>
<p>GC垃圾回收主要是在伊甸园区和养老区~</p>
<p>假设内存满了，OOM，堆内存不够!</p>
<p>在jdk8以后，永久存储区有另外一个名字（元空间）</p>
</li>
<li><p>新生区</p>
<ul>
<li>类：诞生和成长的地方，甚至死亡；</li>
<li>伊甸园，所有的对象都是在伊甸园区new出来的！</li>
<li>幸存者区（0，1）</li>
<li><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-27_193806.png" alt></li>
</ul>
<p>真理：经过研究，99%的对象都是临时对象！</p>
</li>
<li><p>老年区</p>
</li>
<li><p>永久区</p>
<p>这个区域常驻内存的，用来存放JDK自身携带的Class对象。Interface元数据，存储的是Java运行时的一些环境或类信息<del>这个区域不存在垃圾回收！关闭虚拟机就会释放这个区域的内存</del></p>
<p>一个启动类，加载了大量的第三方jar包。Tomcat部署了太多的应用，大量动态生成的反射类。不断地被加载，直到内存满，就会出现OOM；</p>
<ul>
<li><p>jdk1.6之前，永久代，常量池是在方法区中；</p>
</li>
<li><p>jdk1.7，永久代，但是慢慢的退化了，<code>去永久代</code>，常量池在堆中</p>
</li>
<li><p>jdk1.8之后，无永久代，常量池在元空间</p>
</li>
<li><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-27_195510.png" alt></p>
</li>
<li><p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-27_195405.png" alt></p>
</li>
</ul>
<p>元空间逻辑上存在，物理上不存在~</p>
</li>
<li><p>堆内存调优</p>
<p>例子1：元空间逻辑上存在，物理上不存在</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//返回虚拟机试图使用的最大内存</span></span><br><span class="line">        <span class="keyword">long</span> max = Runtime.getRuntime().maxMemory();</span><br><span class="line">        <span class="comment">//返回jvm的总内存</span></span><br><span class="line">        <span class="keyword">long</span> total = Runtime.getRuntime().totalMemory();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"max="</span> + max +<span class="string">"字节\t"</span> + (max/(<span class="keyword">double</span>)<span class="number">1024</span>/<span class="number">1024</span>)+<span class="string">"MB"</span>);</span><br><span class="line">        System.out.println(<span class="string">"total="</span> + total +<span class="string">"字节\t"</span> + (total/(<span class="keyword">double</span>)<span class="number">1024</span>/<span class="number">1024</span>)+<span class="string">"MB"</span>);</span><br><span class="line">        <span class="comment">// 默认情况下：分配的总内存(max)是电脑内存的1/4，而初始化内存(total)：1/64</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//OOM:</span></span><br><span class="line">            <span class="comment">//1、尝试扩大堆内存看结果，如果堆内存扩大了程序还报OOM，那说明是程序写错了</span></span><br><span class="line">            <span class="comment">//2、分析内存，看一下哪个地方出现了问题（专业工具）</span></span><br><span class="line">        <span class="comment">//-Xms1024m -Xmx1024m -XX:+PrintGCDetails</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//305664K(新生代)+699392K(老年代)=981.5MB</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例子2：轻重GC展示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xms8m -Xmx8m -XX:+PrintGCDetails</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">"wyqian"</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            str += str + <span class="keyword">new</span> Random().nextInt(<span class="number">99999999</span>)+<span class="keyword">new</span> Random().nextInt(<span class="number">88888888</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-27_203215.png" alt></p>
<p>在一个项目中，突然出现OOM故障，那么该如何排除？研究为什么出错~</p>
<ul>
<li>能够看到代码第几行出错：内存快照分析工具，MAT，JProfiler</li>
<li>Debug，一行行分析代码！</li>
</ul>
<p><strong><em>MAT，JProfiler作用：</em></strong></p>
<ul>
<li>分析Dump内存文件，快读定位内存泄漏；</li>
<li>获得堆中的数据</li>
<li>获得大的对象~</li>
<li>……</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xms：设置初始化分配内存大小 默认1/64</span></span><br><span class="line"><span class="comment">//-Xmx：设置最大分配内存大小 默认1/4</span></span><br><span class="line"><span class="comment">//-XX:PrintGCDetails  打印GC垃圾回收信息</span></span><br><span class="line"><span class="comment">//-Xms1m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError   OOM Dump文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] array = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Demo03&gt; list = <span class="keyword">new</span> ArrayList&lt;Demo03&gt;();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> Demo03());</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Error e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"count:"</span>+count);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_102356.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_102412.png" alt></p>
</li>
<li><p>GC：垃圾回收机制，不能手动回收</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_163610.png" alt></p>
<p>JVM在进行GC时，并不是对这三个区域统一回收。大部分时候，回收都是新生代~</p>
<ul>
<li>伊甸园区</li>
<li>幸存区（from， to）</li>
<li>老年区</li>
</ul>
<p>GC两种类：轻GC(普通的GC)、重GC(全局GC)</p>
<p>题目：</p>
<ul>
<li>JVM的内存模型和分区~详细到每一个区放什么</li>
<li>堆里面的分区有哪些？Eden，from，to，老年区，说说他们的特点！</li>
<li>GC的算法有哪些？标记清除法，标记整理法，复制算法，引用计数法，怎么用的？</li>
<li>轻GC和重GC分别在什么时候发生？</li>
</ul>
<p><strong><em>引用计数法：</em></strong></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_164559.png" alt></p>
<p><strong><em>复制算法：</em></strong></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_165649.png" alt></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_170110.png" alt></p>
<ul>
<li>好处：没有内存的碎片</li>
<li>坏处：浪费了内存空间~：多了一半空间永远是空to。假设对象100%存活（极端情况）</li>
</ul>
<p>复制算法最佳使用场景：对象存活度较低的时候；新生区~</p>
<p><strong><em>标记清除算法：</em></strong></p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_170911.png" alt></p>
<ul>
<li><p>优点：不需要额外的空间！</p>
</li>
<li><p>缺点：两次扫描，严重浪费时间，会产生内存碎片。</p>
</li>
</ul>
<p><strong><em>标记清除压缩算法：</em></strong></p>
<p>先标记清除几次，再压缩！he</p>
<p>再优化：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_171242.png" alt></p>
</li>
<li><p>总结</p>
</li>
</ol>
<p>内存效率：复制算法&gt;标记清除算法&gt;标记压缩算法（时间复杂度）</p>
<p>内存整齐度：复制算法=标记压缩&gt;标记清除算法</p>
<p>内存利用率：标记压缩算法=标记清除算法&gt;复制算法</p>
<p>思考：难道没有最优的算法吗？</p>
<p>答案：没有，没有最好的算法，只有最合适的算法！—-&gt;GC：分代收集算法</p>
<p>年轻代：</p>
<ul>
<li>存活率低</li>
<li>复制算法！</li>
</ul>
<p>老年代：</p>
<ul>
<li>区域大：存活率高</li>
<li>标记清除（内存碎片不是太多）+标记压缩混合 实现</li>
</ul>
<p>一天时间学JVM，不现实，要深究，必须要下去花时间，和多看面试题，以及《深入理解Java虚拟机》</p>
<p>但是，我们可以掌握一个学习JVM的方法。</p>
<p>18、JMM：Java Memory Model</p>
<ol>
<li><p>什么是JMM？</p>
</li>
<li><p>它干嘛的？：官方，其他人的博客，对应的视频！ </p>
<p>作用：缓存一致性协议，用于定义数据读写的规则（遵守，找到这个规则 ）</p>
<p>JMM定义了线程工作和主内存之间的抽象关系：线程之间的共享变量存储在主内存（Main Memory）中，每个线程都有一个私有的本地内存（Local Memory）</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-28_185803.png" alt></p>
<p>解决共享对象可见性问题：volidate</p>
</li>
<li><p>它如何学习？</p>
<p>JMM：抽象概念，理论</p>
<p>volidate ：</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-29_171421.png" alt></p>
</li>
<li><p>百度</p>
</li>
<li><p>思维导图</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wyqian.top/2021/03/25/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="精进的coder">
      <meta itemprop="description" content="Do not talk, show me your code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SC&KD's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/25/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">如何分析开源项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-25 09:10:00" itemprop="dateCreated datePublished" datetime="2021-03-25T09:10:00+08:00">2021-03-25</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/03/25/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/03/25/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<p> 学习的方式</p>
<ol>
<li>不知道这个代码怎么来的</li>
<li>这个代码跑不起来</li>
<li>这个项目对我们有什么帮助，不会模块化分析</li>
</ol>
<p>任何一个开源项目，都可以让自己得到提升！</p>
<p>下面以一个案例来说明如何分析开源项目：</p>
<p><a href="https://gitee.com/elunez/eladmin" target="_blank" rel="noopener">https://gitee.com/elunez/eladmin</a></p>
<p><a href="https://gitee.com/elunez/eladmin-web" target="_blank" rel="noopener">https://gitee.com/elunez/eladmin-web</a></p>
<h2 id="观察开源项目"><a href="#观察开源项目" class="headerlink" title="观察开源项目"></a>观察开源项目</h2><p>后端的</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_093314.png" alt></p>
<p>前端的</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_094706.png" alt></p>
<h2 id="开源项目下载"><a href="#开源项目下载" class="headerlink" title="开源项目下载"></a>开源项目下载</h2><p>下载完毕，然后解压，优先使用码云下载！</p>
<p>解压，先不要着急运行！</p>
<p><strong><em>观察</em></strong></p>
<ol>
<li>用了哪些技术（Springboot,Vue,Redis,MQ…）</li>
<li>是否有数据库(MySQL)</li>
<li>你的环境是否匹配（java, Maven, npm, nodejs, redis）</li>
</ol>
<p>通过了，然后想办法运行！</p>
<h2 id="跑起来是第一步"><a href="#跑起来是第一步" class="headerlink" title="跑起来是第一步"></a>跑起来是第一步</h2><ol>
<li>安装数据库，执行sql</li>
<li>前端需要跑起来</li>
<li>后端项目<strong><em>导入</em></strong>跑起来</li>
<li>等待所有的项目跑成功！</li>
</ol>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_122739.jpg" alt></p>
<p>只要发现了Swagger，那么跑起来的第一步就是先进入Swagger-ui页面，因为这里面都是接口！</p>
<p>进而查看配置文件！默认端口，有哪些配置，需要改为自己的项目和环境地址！</p>
<p>前端就是安装依赖，启动测试运行，看接口是否正常！</p>
<h2 id="前后端分离项目固定套路"><a href="#前后端分离项目固定套路" class="headerlink" title="前后端分离项目固定套路"></a>前后端分离项目固定套路</h2><ol>
<li><p>从前端开始分析，打开控制台，点一个接口，分析一波调用关系！</p>
</li>
<li><p>前后端端口调用不一致！8013（前端）–8000（后端），怎么操作的</p>
<ul>
<li><p>封装了接口请求  ajax   axios  request</p>
</li>
<li><p>找到配置</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_131534.png" alt></p>
</li>
<li><p>前后端分离项目的重点：找到接口的调用关系</p>
</li>
<li><p>Springboot提供服务！前端调用接口数据！Vue负责渲染页面</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_131758.png" alt></p>
</li>
<li><p>前端项目固定套路</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_132113.png" alt></p>
</li>
<li><p>通过抓取前端的请求，找到后端对应的接口</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_133536.png" alt></p>
</li>
<li><p>后端分析</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_133926.png" alt></p>
</li>
<li><p>Controller–Service–Dao：你就能看懂了</p>
</li>
<li><p>现在从前到后可以分析了！但是如何渲染到视图上呢？看前端</p>
<p><img src="https://gitee.com/Curryforthreeeeee30/HexoPicture/raw/master/PicturteBed/2021-03-25_134502.png" alt></p>
</li>
<li><p>vue标准套路</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  视图层</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    js操作，接口的调用</span><br><span class="line">export default &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">页面的样式</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你现在自己的项目或者你要学习一个模块，将这个模块独立抽取出来即可！删除法</p>
</li>
</ul>
</li>
</ol>
<h2 id="如何找到一个好的开源项目"><a href="#如何找到一个好的开源项目" class="headerlink" title="如何找到一个好的开源项目"></a>如何找到一个好的开源项目</h2><p>用码云做案例：</p>
<ol>
<li>找分类  JAVA</li>
<li>看收藏，开源项目，所有人都觉得不错的，那就是好的！</li>
<li>看具有价值</li>
<li>根据自身的理解情况去看，Java、SSM、Springboot、阶段性成果！</li>
<li>如何学习java</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
    
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="精进的coder"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">精进的coder</p>
  <div class="site-description" itemprop="description">Do not talk, show me your code!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Curryforthreeeeee30" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Curryforthreeeeee30" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wanyun_qian@163.com" title="E-Mail → mailto:wanyun_qian@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/wanyun_qian" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;wanyun_qian" rel="noopener" target="_blank"><i class="fa fa-fighter-jet fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/5262513822/profile?topnav=1&wvr=6&is_all=1" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;5262513822&#x2F;profile?topnav&#x3D;1&amp;wvr&#x3D;6&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=110 src="//music.163.com/outchain/player?type=0&id=5291304129&auto=1&height=90"></iframe>
    </div>
    
    
    
  </aside>
  <div id="sidebar-dimmer"></div>
  


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">精进的coder</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">569k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:37</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>






        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,0' opacity='0.5' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'OFKgux9umN8mfj7KNEwCq3Uc-gzGzoHsz',
      appKey     : 'v6tDnJ3gDBdO0mYlQh4h23BM',
      placeholder: "ヾﾉ≧∀≦)o来啊，快活啊!",
      avatar     : 'monsterid',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  <script type="text/javascript" src="/lib/zclip/clipboard.min.js"></script>	
<script type="text/javascript" src="/js/src/custom.js"></script>
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
